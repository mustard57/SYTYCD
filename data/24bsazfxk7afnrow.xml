<message message-id="BLU0-SMTP217B234D4736825247D024A97E0@phx.gbl" list="org.freebsd.freebsd-ports-bugs" id="24bsazfxk7afnrow" type="bugs" date="2011-06-04T10:07:30+01:00" year="2011-01-01" year-month="2011-06-01" year-month-day="2011-06-04" thread-id="24bsazfxk7afnrow"><headers><envelope-from-line>Sat Jun 04 01:10:27 2011</envelope-from-line><from personal="Chris Rees" address="utisoft@gmail.com">Chris Rees &lt;utisoft@gmail.com&gt;</from><to personal="FreeBSD-gnats-submit@FreeBSD.org" address="FreeBSD-gnats-submit@FreeBSD.org">FreeBSD-gnats-submit@FreeBSD.org</to><subject normal="ports/157581: Fix port: irc/ircd-ru should use USERS">ports/157581: Fix port: irc/ircd-ru should use USERS</subject><received>from srv-117d-be06.markmail.marklogic.com ([172.19.8.66])
          by mail-1.a.markmail.int (JAMES SMTP Server 2.3.1) with SMTP ID 50
          for &lt;earlene.young.roy@a.markmail.org&gt;;
          Sat, 4 Jun 2011 01:10:27 -0800 (GMT-08:00)</received><received>from mx2.freebsd.org (slb-117n.markmail.marklogic.com [172.19.8.33])
	by mgw-2.public.markmail.int (Postfix) with ESMTP id 8AF543B30273
	for &lt;earlene.young.roy@a.markmail.org&gt;; Sat,  4 Jun 2011 02:10:04 -0700 (PDT)</received><received>from hub.freebsd.org (hub.freebsd.org [IPv6:2001:4f8:fff6::36])
	by mx2.freebsd.org (Postfix) with ESMTP id B37D9158EE7;
	Sat,  4 Jun 2011 09:10:23 +0000 (UTC)</received><received>from hub.freebsd.org (localhost [127.0.0.1])
	by hub.freebsd.org (Postfix) with ESMTP id A07771065670;
	Sat,  4 Jun 2011 09:10:23 +0000 (UTC)
	(envelope-from owner-freebsd-ports-bugs@freebsd.org)</received><delivered-to>freebsd-ports-bugs@hub.freebsd.org</delivered-to><received>from mx1.freebsd.org (mx1.freebsd.org [IPv6:2001:4f8:fff6::34])
	by hub.freebsd.org (Postfix) with ESMTP id 45A7A1065676
	for &lt;freebsd-ports-bugs@hub.freebsd.org&gt;;
	Sat,  4 Jun 2011 09:10:10 +0000 (UTC)
	(envelope-from gnats@FreeBSD.org)</received><received>from freefall.freebsd.org (freefall.freebsd.org
	[IPv6:2001:4f8:fff6::28])
	by mx1.freebsd.org (Postfix) with ESMTP id 1B3A28FC17
	for &lt;freebsd-ports-bugs@hub.freebsd.org&gt;;
	Sat,  4 Jun 2011 09:10:10 +0000 (UTC)</received><received>from freefall.freebsd.org (localhost [127.0.0.1])
	by freefall.freebsd.org (8.14.4/8.14.4) with ESMTP id p549A9Pn014054
	for &lt;freebsd-ports-bugs@freefall.freebsd.org&gt;;
	Sat, 4 Jun 2011 09:10:09 GMT
	(envelope-from gnats@freefall.freebsd.org)</received><received>(from gnats@localhost)
	by freefall.freebsd.org (8.14.4/8.14.4/Submit) id p549A9O7014053;
	Sat, 4 Jun 2011 09:10:09 GMT (envelope-from gnats)</received><resent-date>Sat, 4 Jun 2011 09:10:09 GMT</resent-date><resent-message-id>&lt;201106040910.p549A9O7014053@freefall.freebsd.org&gt;</resent-message-id><resent-from>FreeBSD-gnats-submit@FreeBSD.org (GNATS Filer)</resent-from><resent-to>freebsd-ports-bugs@FreeBSD.org</resent-to><resent-reply-to>FreeBSD-gnats-submit@FreeBSD.org,
	Chris Rees &lt;utisoft@gmail.com&gt;</resent-reply-to><received>from mx1.freebsd.org (mx1.freebsd.org [IPv6:2001:4f8:fff6::34])
	by hub.freebsd.org (Postfix) with ESMTP id A571F1065670
	for &lt;FreeBSD-gnats-submit@freebsd.org&gt;;
	Sat,  4 Jun 2011 09:08:07 +0000 (UTC)
	(envelope-from utisoft@hotmail.com)</received><received>from blu0-omc1-s26.blu0.hotmail.com (blu0-omc1-s26.blu0.hotmail.com
	[65.55.116.37]) by mx1.freebsd.org (Postfix) with ESMTP id 656418FC08
	for &lt;FreeBSD-gnats-submit@freebsd.org&gt;;
	Sat,  4 Jun 2011 09:08:07 +0000 (UTC)</received><received>from BLU0-SMTP21 ([65.55.116.9]) by blu0-omc1-s26.blu0.hotmail.com
	with Microsoft SMTPSVC(6.0.3790.4675); 
	Sat, 4 Jun 2011 02:08:07 -0700</received><received>from zeus.bayofrum.net ([90.221.7.100]) by BLU0-SMTP21.phx.gbl over
	TLS secured channel with Microsoft SMTPSVC(6.0.3790.4675); 
	Sat, 4 Jun 2011 02:08:05 -0700</received><received>from zeus.bayofrum.net (crees@localhost [127.0.0.1])
	by zeus.bayofrum.net (8.14.4/8.14.4) with ESMTP id p5497UuD006097
	(version=TLSv1/SSLv3 cipher=DHE-DSS-AES256-SHA bits=256 verify=NO)
	for &lt;FreeBSD-gnats-submit@freebsd.org&gt;;
	Sat, 4 Jun 2011 10:07:31 +0100 (BST)
	(envelope-from chris@zeus.bayofrum.net)</received><received>(from crees@localhost)
	by zeus.bayofrum.net (8.14.4/8.14.4/Submit) id p5497UEg006096;
	Sat, 4 Jun 2011 10:07:30 +0100 (BST) (envelope-from chris)</received><message-id>BLU0-SMTP217B234D4736825247D024A97E0@phx.gbl</message-id><date>Sat, 4 Jun 2011 10:07:30 +0100</date><x-send-pr-version>3.113</x-send-pr-version><x-beenthere>freebsd-ports-bugs@freebsd.org</x-beenthere><x-mailman-version>2.1.5</x-mailman-version><precedence>list</precedence><reply-to>Chris Rees &lt;utisoft@gmail.com&gt;</reply-to><list-id>Ports bug reports &lt;freebsd-ports-bugs.freebsd.org&gt;</list-id><list-unsubscribe>&lt;http://lists.freebsd.org/mailman/listinfo/freebsd-ports-bugs&gt;, 
	&lt;mailto:freebsd-ports-bugs-request@freebsd.org?subject=unsubscribe&gt;</list-unsubscribe><list-archive>&lt;http://lists.freebsd.org/pipermail/freebsd-ports-bugs&gt;</list-archive><list-post>&lt;mailto:freebsd-ports-bugs@freebsd.org&gt;</list-post><list-help>&lt;mailto:freebsd-ports-bugs-request@freebsd.org?subject=help&gt;</list-help><list-subscribe>&lt;http://lists.freebsd.org/mailman/listinfo/freebsd-ports-bugs&gt;, 
	&lt;mailto:freebsd-ports-bugs-request@freebsd.org?subject=subscribe&gt;</list-subscribe><sender>owner-freebsd-ports-bugs@freebsd.org</sender><errors-to>owner-freebsd-ports-bugs@freebsd.org</errors-to></headers><normalized-references><normalized-message-id>BLU0-SMTP217B234D4736825247D024A97E0@phx.gbl</normalized-message-id></normalized-references><body type="text/plain"><para depth="0">
</para><quote depth="1"><quotepara depth="1">Number:         157581
Category:       ports
Synopsis:       Fix port: irc/ircd-ru should use USERS
Confidential:   no
Severity:       non-critical
Priority:       low
Responsible:    freebsd-ports-bugs
State:          open
Quarter:        
Keywords:       
Date-Required:
Class:          change-request
Submitter-Id:   current-users
Arrival-Date:   Sat Jun 04 09:10:09 UTC 2011
Closed-Date:
Last-Modified:
Originator:     Chris Rees
Release:        FreeBSD 8.2-RELEASE-p1 i386
Organization:
bayofrum
Environment:
</quotepara></quote><para depth="0">System: FreeBSD zeus.bayofrum.net 8.2-RELEASE-p1 FreeBSD 8.2-RELEASE-p1 #0: Sat<br/>Apr 30 15:09:06 BST 2011 <email>root@zeus.bayofrum.net</email>:/usr/obj/usr/src/sys/ZEUS i386

</para><quote depth="1"><quotepara depth="1">Description:
</quotepara></quote><para depth="0">
	This port uses pkg-install to create new users instead of using USERS= and<br/>GROUPS=

</para><para depth="0">It also tries to delete users on deinstall without prompting -- this is a<br/>problem if another installed port uses that username.
</para><quote depth="1"><quotepara depth="1">How-To-Repeat:
</quotepara></quote><para depth="0">
</para><quote depth="1"><quotepara depth="1">Fix:
</quotepara></quote><para depth="0">
	- Use USERS and GROUPS

</para><para depth="0">	Submitted by: Chris Rees (<email>utisoft@gmail.com</email>)

</para><para depth="0">	Please bear in mind that pkg-install has been removed.

</para><para depth="0">--- irc-ircd-ru.patch begins here ---
Index: Makefile
===================================================================
RCS file: /exports/cvsroot-freebsd/ports/irc/ircd-ru/Makefile,v
retrieving revision 1.17
diff -u -r1.17 Makefile
--- Makefile	19 Apr 2010 10:43:24 -0000	1.17
+++ Makefile	2 Jun 2011 19:22:51 -0000
@@ -21,6 +21,9 @@
 USE_RC_SUBR=	ircd
 WRKSRC=		${WRKDIR}/ircd-RU-${PORTVERSION}-03-rc

</para><para depth="0">+USERS=		ircd
+GROUPS=		${USERS}
+
 VARDIR=		/var
 PLIST_SUB=	VARDIR=${VARDIR}

</para><para depth="0">@@ -87,9 +90,6 @@
 	@${ECHO_MSG} " Edit ${WRKSRC}/include/config.h for specific settings "
 	@${ECHO_MSG} ""

</para><para depth="0">-pre-install:
-	@${SH} ${PKGINSTALL} ${PKGNAME} PRE-INSTALL
-
 post-install:
 	@${CHOWN} -R ircd:ircd ${VARDIR}/log/ircd-ru
 	@${CAT} ${PKGMESSAGE}
Index: pkg-install
===================================================================
RCS file: pkg-install
diff -N pkg-install
--- pkg-install	7 Aug 2003 13:14:37 -0000	1.1
+++ /dev/null	1 Jan 1970 00:00:00 -0000
@@ -1,68 +0,0 @@
-#!/bin/sh
-
-# This script is a modified copy of the pkg-install script 
-# from the original ircd-hybrid port.
-
-if [ "x$2" != "xPRE-INSTALL" ]; then
-	exit 0;
-fi
-
-
-if ! which -s pw ; then
-	cat &lt;&lt;EOF
-Your system does not include the "pw" utility.  You should upgrade
-to a newer version of FreeBSD.  Without "pw" this script will not
-run.
-EOF
-	exit 1
-fi
-
-uid=72
-user=ircd
-gid=$uid
-group=$user
-gecos="Russian IRC daemon" 
-shell="/bin/sh"
-home="/nonexistent"
-
-echo ""
-if pw groupshow $group 2&gt; /dev/null ; then
-	echo "You already have a group \"$group\", so I will use it."
-else
-	if pw groupshow $gid 2&gt; /dev/null ; then
-		echo "You already have a gid \"$gid\".  Please create a user \"$group\""
-		echo "with a default group of \"$group\"."
-		exit 1
-	fi
-	echo "You need a group \"$group\"."
-	if which -s pw ; then
-		pw groupadd $group -g $gid || exit
-		echo "Done."
-	else
-		echo "Please create it, and try again."
-		if ! pw usershow $user 2&gt; /dev/null ; then
-			echo "While you're at it, please create a user \"$user\""
-			echo 'too, with a default group of "$group".'
-		fi
-		exit 1
-	fi
-fi
-
-if pw usershow $user 2&gt; /dev/null ; then
-	echo "You already have a user \"$user\", so I will use it."
-else
-        if pw usershow $uid 2&gt; /dev/null ; then
-                echo "You already have a uid \"$uid\".  Please create a user<br/>\"ircd\""
-                echo "with a default group of \"$group\"."
-                exit 1
-        fi
-	echo "You need a user \"$user\"."
-	if which -s pw; then
-		pw useradd $user -g $group -u $uid -h - -d $home \
-			-s "$shell" -c "$gecos" || exit
-		echo "Done."
-	else
-		echo "Please create it, and try again."
-		exit 1
-	fi
-fi
Index: pkg-plist
===================================================================
RCS file: /exports/cvsroot-freebsd/ports/irc/ircd-ru/pkg-plist,v
retrieving revision 1.7
diff -u -r1.7 pkg-plist
--- pkg-plist	30 Dec 2006 19:49:40 -0000	1.7
+++ pkg-plist	2 Jun 2011 19:24:40 -0000
@@ -28,4 +28,4 @@
 @exec chown ircd:ircd %%VARDIR%%/log/ircd-ru
 @unexec rmdir %%VARDIR%%/log/ircd-ru
 @unexec rmdir %%VARDIR%%/run/ircd-ru
-@unexec (rmdir %D/etc/ircd-ru &amp;&amp; pw user del ircd) || echo 'To completely<br/>remove this port delete user ircd, group ircd and remove etc/ircd-ru'
+@unexec rmdir %D/etc/ircd-ru || echo 'To completely remove this port remove<br/>etc/ircd-ru'
--- irc-ircd-ru.patch ends here ---

</para><footer type="virus-scan" depth="0">-- 
This message has been scanned for viruses and
dangerous content by MailScanner, and is
believed to be clean.

</footer><quote depth="1"><quotepara depth="1">Release-Note:
Audit-Trail:
Unformatted:
</quotepara></quote><footer type="list-management" depth="0">_______________________________________________
<email>freebsd-ports-bugs@freebsd.org</email> mailing list
<url>http://lists.freebsd.org/mailman/listinfo/freebsd-ports-bugs</url>
To unsubscribe, send any mail to "<email>freebsd-ports-bugs-unsubscribe@freebsd.org</email>"
</footer></body></message>