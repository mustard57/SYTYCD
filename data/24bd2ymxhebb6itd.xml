<message message-id="5dd474260807170239l2503e864k553e94a63b224471@mail.gmail.com" list="org.apache.tomcat.users" id="24bd2ymxhebb6itd" type="users" date="2008-07-17T10:39:08+01:00" year="2008-01-01" year-month="2008-07-01" year-month-day="2008-07-17" thread-id="bth4pahkdk4ssyly"><headers><envelope-from-line>Thu Jul 17 02:39:49 2008</envelope-from-line><from personal="Joe Walker" address="joe@getahead.org">Joe Walker &lt;joe@getahead.org&gt;</from><to personal="Tomcat Users List" address="users@tomcat.apache.org">Tomcat Users List &lt;users@tomcat.apache.org&gt;</to><subject normal="CometProcessor and DWR">Re: CometProcessor and DWR</subject><received>from srv-117d-be06.markmail.marklogic.com ([172.19.8.66])
          by mail-1.a.markmail.int (JAMES SMTP Server 2.3.1) with SMTP ID 794
          for &lt;maurice.mcintosh.sargent@a.markmail.org&gt;;
          Thu, 17 Jul 2008 02:39:49 -0700 (PDT)</received><received>from mail.apache.org (slb-117n.markmail.marklogic.com [172.19.8.33])
	by mgw-2.public.markmail.int (Postfix) with SMTP id 1C38D3B300B8
	for &lt;maurice.mcintosh.sargent@a.markmail.org&gt;; Thu, 17 Jul 2008 02:39:49 -0700 (PDT)</received><received>(qmail 65083 invoked by uid 500); 17 Jul 2008 09:39:38 -0000</received><mailing-list>contact users-help@tomcat.apache.org; run by ezmlm</mailing-list><precedence>bulk</precedence><list-help>&lt;mailto:users-help@tomcat.apache.org&gt;</list-help><list-unsubscribe>&lt;mailto:users-unsubscribe@tomcat.apache.org&gt;</list-unsubscribe><list-post>&lt;mailto:users@tomcat.apache.org&gt;</list-post><list-id>&lt;users.tomcat.apache.org&gt;</list-id><reply-to>"Tomcat Users List" &lt;users@tomcat.apache.org&gt;</reply-to><delivered-to>mailing list users@tomcat.apache.org</delivered-to><received>(qmail 65072 invoked by uid 99); 17 Jul 2008 09:39:38 -0000</received><received>from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 17 Jul 2008 02:39:38 -0700</received><x-asf-spam-status>No, hits=2.0 required=10.0
	tests=HTML_MESSAGE,SPF_PASS</x-asf-spam-status><x-spam-check-by>apache.org</x-spam-check-by><received-spf>pass (athena.apache.org: domain of joseph.walker@gmail.com designates 66.249.92.169 as permitted sender)</received-spf><received>from [66.249.92.169] (HELO ug-out-1314.google.com) (66.249.92.169)
    by apache.org (qpsmtpd/0.29) with ESMTP; Thu, 17 Jul 2008 09:38:45 +0000</received><received>by ug-out-1314.google.com with SMTP id s2so742381uge.30
        for &lt;users@tomcat.apache.org&gt;; Thu, 17 Jul 2008 02:39:08 -0700 (PDT)</received><dkim-signature>v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:message-id:date:from:sender
         :to:subject:in-reply-to:mime-version:content-type:references
         :x-google-sender-auth;
        bh=BXlP3A8KXjaMxW4ar322ia+haDmCB9HfiCaSJI7Q5zM=;
        b=M7O4DvTH0HWZHjM4x3qsHrTGJafkAtiHKPNfE+Fg1flyu7sryE69dXW/ZHl1JqQh9+
         BQRH6B4N5iqo91s0oyFvKQIzVXVtEiQaQk/IkCBYAfhO18oug5hoi+Ef0nZuQu4AyNIy
         NvtqyamaLnYdjZzMXankXezAmsqDlRPv8rA0U=</dkim-signature><domainkey-signature>a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=message-id:date:from:sender:to:subject:in-reply-to:mime-version
         :content-type:references:x-google-sender-auth;
        b=HYEGzdsU1dwVjU5ni/9XfqZs1mrXpccFN5+u5251HII8Ua6sNegfIM+cfhnyUr/gkh
         bEnoxLdYPKBLwTw8Px0Eg9ulFeG0XKkQN8DJIX6VFuB5X/Jm3DdK1sMFqCamCQ5ejTey
         lwoRZButLocHF6jp4jxrj08VhDAp/DOSCqXIY=</domainkey-signature><received>by 10.67.21.11 with SMTP id y11mr3767860ugi.70.1216287548091;
        Thu, 17 Jul 2008 02:39:08 -0700 (PDT)</received><received>by 10.67.102.12 with HTTP; Thu, 17 Jul 2008 02:39:08 -0700 (PDT)</received><message-id>5dd474260807170239l2503e864k553e94a63b224471@mail.gmail.com</message-id><date>Thu, 17 Jul 2008 10:39:08 +0100</date><sender>joseph.walker@gmail.com</sender><in-reply-to>&lt;487EB6B5.9030901@hanik.com&gt;</in-reply-to><mime-version>1.0</mime-version><content-type>multipart/alternative; 
	boundary="----=_Part_23781_6603902.1216287548098"</content-type><references>&lt;5dd474260807160302w16f20454k27ac441038ddbe8d@mail.gmail.com&gt;
	 &lt;487EB6B5.9030901@hanik.com&gt;</references><x-google-sender-auth>2f740c8b36efe0c7</x-google-sender-auth><x-virus-checked>Checked by ClamAV on apache.org</x-virus-checked></headers><normalized-references><normalized-message-id>5dd474260807170239l2503e864k553e94a63b224471@mail.gmail.com</normalized-message-id><normalized-in-reply-to>487EB6B5.9030901@hanik.com</normalized-in-reply-to><normalized-reference>5dd474260807160302w16f20454k27ac441038ddbe8d@mail.gmail.com</normalized-reference><normalized-reference>487EB6B5.9030901@hanik.com</normalized-reference></normalized-references><body multipart="multipart/alternative; &#13;&#10;&#9;boundary=&quot;----=_part_23781_6603902.1216287548098&quot;" type="text/plain; charset=ISO-8859-1"><para depth="0">Thanks for the help Philip.

</para><para depth="0">So I was hoping to use the normal Servlet processing for all requests, and
then do something special to drop a thread when doing comet.
My event method looks like this:

</para><para depth="0">public void event(CometEvent event) throws IOException, ServletException {
    if (event.getEventType() == CometEvent.EventType.BEGIN) {
        event.getHttpServletRequest().setAttribute(ATTRIBUTE_EVENT, event);
    }
    else if (event.getEventType() == CometEvent.EventType.ERROR) {
        event.close();
    }
    else if (event.getEventType() == CometEvent.EventType.END) {
        event.close();
    }
    else if (event.getEventType() == CometEvent.EventType.READ) {
        // Does this handle blocking reads if we just carry on reading?
        service(event.getHttpServletRequest(),
event.getHttpServletResponse());
    }
}

</para><para depth="0">The effect that I'm seeing is a call to event() with event.getEventType() ==
CometEvent.EventType.BEGIN as expected, but I'm expecting some READ events,
but nothing until an ERROR(TIMEOUT) event a bit later.

</para><para depth="0">When Tomcat starts it says:
Jul 17, 2008 10:35:31 AM org.apache.catalina.core.AprLifecycleListener init
INFO: The Apache Tomcat Native library which allows optimal performance in
production environments was not found on the java.library.path:
.:/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java
Jul 17, 2008 10:35:35 AM org.apache.coyote.http11.Http11NioProtocol init
INFO: Initializing Coyote HTTP/1.1 on http-8080
Jul 17, 2008 10:35:35 AM org.apache.catalina.startup.Catalina load
INFO: Initialization processed in 8828 ms
Jul 17, 2008 10:35:35 AM org.apache.catalina.core.StandardService start
INFO: Starting service Catalina
Jul 17, 2008 10:35:35 AM org.apache.catalina.core.StandardEngine start
INFO: Starting Servlet Engine: Apache Tomcat/6.0.14

</para><para depth="0">Do I need to fire up a C compiler to get this to work?

</para><para depth="0">Joe.

</para><para depth="0">On Thu, Jul 17, 2008 at 4:04 AM, Filip Hanik - Dev Lists &lt;<email>devlists@hanik.com</email>&gt;
wrote:

</para><quote depth="1"><quotepara depth="1">for your connector element you must have

</quotepara><quotepara depth="1">protocol="org.apache.coyote.http11.Http11NioProtocol"
or
protocol="org.apache.coyote.http11.Http11AprProtocol"  (and the APR and
tcnative libraries in your PATH/LD_LIBRARY_PATH)

</quotepara><quotepara depth="1">Filip
Joe Walker wrote:

</quotepara><quote depth="2"><quotepara depth="2">Hi,

</quotepara><quotepara depth="2">It looks like servlet spec 3 is waaaay off. So I'm creating a
implementation
of CometProcessor in DWR.
I've created a new CometProcessor like this:

</quotepara><quotepara depth="2">public class DwrCometProcessor extends DwrServlet implements
CometProcessor

</quotepara><quotepara depth="2">But the event() method is not called. It just leaps straight to service().
Is there anything else I need to be doing (clearly I've changed web.xml to
point at the new 'servlet' using &lt;servlet-class&gt;
org.directwebremoting.servers.tomcat.DwrCometProcessor&lt;/servlet-class&gt;)?

</quotepara><quotepara depth="2">Joe.

</quotepara><quotepara depth="2"> ------------------------------------------------------------------------

</quotepara><quotepara depth="2">No virus found in this incoming message.
Checked by AVG. Version: 7.5.526 / Virus Database: 270.4.11/1554 - Release
Date: 7/15/2008 6:03 PM

</quotepara></quote><quotefooter type="list-management" hash="12065294432598760294" depth="1">---------------------------------------------------------------------
To start a new topic, e-mail: <email>users@tomcat.apache.org</email>
To unsubscribe, e-mail: <email>users-unsubscribe@tomcat.apache.org</email>
For additional commands, e-mail: <email>users-help@tomcat.apache.org</email>

</quotefooter></quote></body></message>