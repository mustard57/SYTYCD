<message message-id="20110206185252.GA6439@p183.telecom.by" list="org.kernel.vger.linux-kernel" id="24aeyj4vejmhg3sy" type="development" date="2011-02-06T10:52:43.836602-08:00" year="2011-01-01" year-month="2011-02-01" year-month-day="2011-02-06" thread-id="ysqh4mqtwwtbt5fh"><headers><envelope-from-line>Sun Feb 06 10:53:06 2011</envelope-from-line><from personal="Alexey Dobriyan" address="adobriyan@gmail.com">Alexey Dobriyan &lt;adobriyan@gmail.com&gt;</from><to personal="Borislav Petkov" address="bp@alien8.de">Borislav Petkov &lt;bp@alien8.de&gt;</to><subject normal="[PATCH 16/52] kstrtox: convert drivers/edac/">Re: [PATCH 16/52] kstrtox: convert drivers/edac/</subject><received>from srv-117d-be06.markmail.marklogic.com ([172.19.8.66])
          by mail-1.a.markmail.int (JAMES SMTP Server 2.3.1) with SMTP ID 828
          for &lt;archive.user.1834@a.markmail.org&gt;;
          Sun, 6 Feb 2011 10:53:06 -0800 (GMT-08:00)</received><received>from vger.kernel.org (slb-117n.markmail.marklogic.com [172.19.8.33])
	by mgw-2.public.markmail.int (Postfix) with ESMTP id 634FA3B30399
	for &lt;archive.user.1834@a.markmail.org&gt;; Sun,  6 Feb 2011 10:52:43 -0800 (PST)</received><received>(majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1753585Ab1BFSxC (ORCPT
	&lt;rfc822;archive.user.1834@a.markmail.org&gt;);
	Sun, 6 Feb 2011 13:53:02 -0500</received><received>from mail-bw0-f46.google.com ([209.85.214.46]:44028 "EHLO
	mail-bw0-f46.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1753303Ab1BFSxA (ORCPT
	&lt;rfc822;linux-kernel@vger.kernel.org&gt;);
	Sun, 6 Feb 2011 13:53:00 -0500</received><received>by bwz15 with SMTP id 15so4294439bwz.19
        for &lt;linux-kernel@vger.kernel.org&gt;; Sun, 06 Feb 2011 10:52:59 -0800 (PST)</received><dkim-signature>v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:date:from:to:subject:message-id:references
         :mime-version:content-type:content-disposition:in-reply-to
         :user-agent;
        bh=tZQr7W3Sj+iSqxu1K7XpxJ8xc8BLQp4Xgw7err5uHP4=;
        b=APKV0oYMoIK8Uo6L1UZNG/rumCt/tkfkCb+ESHJKAeN5iM48fTw1y2en6jmlOHNuW7
         /XytzZlFZQCTR9/i4Hp97qFbURXu6MldMe0BIH5S8SiAkpqT+pVRFZMbJj3EMbKV9+Fo
         I6tn5tLsCWv3+EcPr5Zq8MUToB+QVRBXiaHy0=</dkim-signature><domainkey-signature>a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=date:from:to:subject:message-id:references:mime-version
         :content-type:content-disposition:in-reply-to:user-agent;
        b=hvMtb4KAvlVciabFiE341fUQJJ356VIm0Y0kdN7hwYjQVlZUk9jKw9682W7hOL45EK
         grxy197enIku7XDHRGyaJrAZ5HL9aUDBitQNp9uhYI7pG9ShLzOZJVEsvvk1grdi784b
         FQt6I9kXF7DokJGpaxAbzyPzq8RyvH69JoC7U=</domainkey-signature><received>by 10.204.22.10 with SMTP id l10mr2089846bkb.49.1297018379217;
        Sun, 06 Feb 2011 10:52:59 -0800 (PST)</received><received>from p183.telecom.by (vulture-nat-36.telecom.by [213.184.224.36])
        by mx.google.com with ESMTPS id j11sm1586188bka.12.2011.02.06.10.52.55
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Sun, 06 Feb 2011 10:52:56 -0800 (PST)</received><date>Sun, 6 Feb 2011 20:52:52 +0200</date><message-id>20110206185252.GA6439@p183.telecom.by</message-id><references>&lt;1296915654-7458-1-git-send-email-adobriyan@gmail.com&gt;
 &lt;1296915654-7458-16-git-send-email-adobriyan@gmail.com&gt;
 &lt;20110205173449.GA31845@liondog.tnic&gt;</references><mime-version>1.0</mime-version><content-type>text/plain; charset=us-ascii</content-type><content-disposition>inline</content-disposition><in-reply-to>&lt;20110205173449.GA31845@liondog.tnic&gt;</in-reply-to><user-agent>Mutt/1.5.20 (2009-06-14)</user-agent><sender>linux-kernel-owner@vger.kernel.org</sender><precedence>bulk</precedence><list-id>&lt;linux-kernel.vger.kernel.org&gt;</list-id><x-mailing-list>linux-kernel@vger.kernel.org</x-mailing-list></headers><normalized-references><normalized-message-id>20110206185252.GA6439@p183.telecom.by</normalized-message-id><normalized-in-reply-to>20110205173449.GA31845@liondog.tnic</normalized-in-reply-to><normalized-reference>1296915654-7458-1-git-send-email-adobriyan@gmail.com</normalized-reference><normalized-reference>1296915654-7458-16-git-send-email-adobriyan@gmail.com</normalized-reference><normalized-reference>20110205173449.GA31845@liondog.tnic</normalized-reference></normalized-references><body type="text/plain; charset=us-ascii"><para depth="0">On Sat, Feb 05, 2011 at 06:34:49PM +0100, Borislav Petkov wrote:
</para><quote depth="1"><quotepara depth="1">On Sat, Feb 05, 2011 at 04:20:19PM +0200, Alexey Dobriyan wrote:

</quotepara><quotepara depth="1">Some kind of a boilerplate commit message is still better than none at all.

</quotepara><quote depth="2"><quotepara depth="2">Signed-off-by: Alexey Dobriyan &lt;<email>adobriyan@gmail.com</email>&gt;
</quotepara><quotepara depth="2">---
 drivers/edac/amd64_edac_inj.c |  135 +++++++++++++++++------------------------
 drivers/edac/edac_mc_sysfs.c  |   20 +++---
 drivers/edac/i7core_edac.c    |   41 +++++++------
 drivers/edac/mce_amd_inj.c    |   28 ++++-----
 4 files changed, 101 insertions(+), 123 deletions(-)

</quotepara><quotepara depth="2">diff --git a/drivers/edac/amd64_edac_inj.c b/drivers/edac/amd64_edac_inj.c
index 688478d..180a498 100644
--- a/drivers/edac/amd64_edac_inj.c
+++ b/drivers/edac/amd64_edac_inj.c
@@ -16,21 +16,18 @@ static ssize_t amd64_inject_section_store(struct<br/>mem_ctl_info *mci,
 					  const char *data, size_t count)
 {
 	struct amd64_pvt *pvt = mci-&gt;pvt_info;
-	unsigned long value;
-	int ret = 0;
-
-	ret = strict_strtoul(data, 10, &amp;value);
-	if (ret != -EINVAL) {
-
-		if (value &gt; 3) {
-			amd64_warn("%s: invalid section 0x%lx\n", __func__, value);
-			return -EINVAL;
-		}
-
-		pvt-&gt;injection.section = (u32) value;
-		return count;
+	u32 value;
+	int ret;
+
+	ret = kstrtou32(data, 10, &amp;value);
+	if (ret &lt; 0)
+		return ret;
</quotepara></quote><quotepara depth="1">
newline here
</quotepara></quote><para depth="0">
A what? Why?

</para><quote depth="1"><quote depth="2"><quotepara depth="2">@@ -107,29 +98,22 @@ static ssize_t amd64_inject_read_store(struct mem_ctl_info<br/>*mci,
 					const char *data, size_t count)
 {
 	struct amd64_pvt *pvt = mci-&gt;pvt_info;
-	unsigned long value;
 	u32 section, word_bits;
-	int ret = 0;
-
-	ret = strict_strtoul(data, 10, &amp;value);
-	if (ret != -EINVAL) {
</quotepara></quote><quotepara depth="1">
Dropping those would mean that the injection read (and write) below
would happen on any value written.
</quotepara></quote><para depth="0">
Yes, since the value written is unused, and all data were already
written via other files.

</para><quote depth="1"><quotepara depth="1">Let's keep them and enforce a write
of '1' to be only valid injection trigger like the rest of the /sysfs
interfaces:
</quotepara></quote><para depth="0">
Right now, any number will do, so in fact it'd be better to use kstrtoul().

</para><quote depth="1"><quotepara depth="1">	ret = kstrtou8(data, 10, &amp;value);
	if (ret &lt; 0)
		return ret;

</quotepara><quotepara depth="1">	if (value != 1)
		return -EINVAL;
</quotepara><quote depth="2"><quotepara depth="2">@@ -197,17 +174,15 @@ struct mcidev_sysfs_attribute amd64_inj_attrs[] = {
 	{
 		.attr = {
 			.name = "inject_write",
-			.mode = (S_IRUGO | S_IWUSR)
+			.mode = S_IWUSR,
</quotepara></quote><quotepara depth="1">
This change is not mentioned anywhere, why do we need it?
</quotepara></quote><para depth="0">
File is write-only. I'll mention this in changelog.

</para><quote depth="1"><quote depth="2"><quotepara depth="2">-		.show = NULL,
 		.store = amd64_inject_write_store,
 	},
 	{
 		.attr = {
 			.name = "inject_read",
-			.mode = (S_IRUGO | S_IWUSR)
+			.mode = S_IWUSR,
</quotepara></quote></quote><footer type="noise" depth="0">
</footer><footer type="list-management" depth="0">--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to <email>majordomo@vger.kernel.org</email>
More majordomo info at  <url>http://vger.kernel.org/majordomo-info.html</url>
Please read the FAQ at  <url>http://www.tux.org/lkml/</url>
</footer></body></message>