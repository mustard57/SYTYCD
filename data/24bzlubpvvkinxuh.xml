<message message-id="20071031022038.389c1336@gumby.homeunix.com." list="org.squid-cache.squid-users" id="24bzlubpvvkinxuh" type="users" date="2007-10-31T02:20:38Z" year="2007-01-01" year-month="2007-10-01" year-month-day="2007-10-30" thread-id="vwg4tngsalr7afeo"><headers><envelope-from-line>From - Mon Nov 09 14:45:13 2007</envelope-from-line><from personal="RW" address="fbsd06@mlists.homeunix.com">RW &lt;fbsd06@mlists.homeunix.com&gt;</from><to personal="squid-users@squid-cache.org" address="squid-users@squid-cache.org">squid-users@squid-cache.org</to><subject normal="Help on Refresh Pattern options">Re: Help on Refresh Pattern options</subject><return-path>gcwsg-squid-users@m.gmane.org</return-path><mailing-list>contact squid-users-help@squid-cache.org; run by ezmlm</mailing-list><delivered-to>mailing list squid-users@squid-cache.org</delivered-to><received>(qmail 21872 invoked by uid 26); 31 Oct 2007 02:21:01 -0000</received><received>from ciao.gmane.org (main.gmane.org [80.91.229.2])
	by squid-cache.org (8.14.1/8.14.0) with ESMTP id l9V2Kxgu021845
	(version=TLSv1/SSLv3 cipher=AES256-SHA bits=256 verify=NOT)
	for &lt;squid-users@squid-cache.org&gt;; Tue, 30 Oct 2007 20:21:01 -0600 (MDT)
	(envelope-from gcwsg-squid-users@m.gmane.org)</received><received>from list by ciao.gmane.org with local (Exim 4.43)
	id 1In3CN-0007kC-QO
	for squid-users@squid-cache.org; Wed, 31 Oct 2007 02:20:51 +0000</received><received>from bb-87-81-140-128.ukonline.co.uk ([87.81.140.128])
        by main.gmane.org with esmtp (Gmexim 0.1 (Debian))
        id 1AlnuQ-0007hv-00
        for &lt;squid-users@squid-cache.org&gt;; Wed, 31 Oct 2007 02:20:51 +0000</received><received>from fbsd06 by bb-87-81-140-128.ukonline.co.uk with local (Gmexim 0.1 (Debian))
        id 1AlnuQ-0007hv-00
        for &lt;squid-users@squid-cache.org&gt;; Wed, 31 Oct 2007 02:20:51 +0000</received><x-injected-via-gmane>http://gmane.org/</x-injected-via-gmane><date>Wed, 31 Oct 2007 02:20:38 +0000</date><lines>63</lines><message-id>20071031022038.389c1336@gumby.homeunix.com.</message-id><references>&lt;1147.130.217.140.56.1193787099.squirrel@webmail.treenet.co.nz&gt;</references><mime-version>1.0</mime-version><content-type>text/plain; charset=US-ASCII</content-type><content-transfer-encoding>7bit</content-transfer-encoding><x-complaints-to>usenet@ger.gmane.org</x-complaints-to><x-gmane-nntp-posting-host>bb-87-81-140-128.ukonline.co.uk</x-gmane-nntp-posting-host><x-newsreader>Claws Mail 3.0.2 (GTK+ 2.12.1; i386-portbld-freebsd6.2)</x-newsreader><sender>news &lt;news@ger.gmane.org&gt;</sender><x-greylist>Sender is SPF-compliant, not delayed by milter-greylist-3.0 (squid-cache.org [12.160.37.9]); Tue, 30 Oct 2007 20:21:01 -0600 (MDT)</x-greylist><x-virus-scanned>ClamAV 0.91.1/4641/Tue Oct 30 13:59:09 2007 on squid-cache.org</x-virus-scanned><x-virus-status>Clean</x-virus-status></headers><normalized-references><normalized-message-id>20071031022038.389c1336@gumby.homeunix.com.</normalized-message-id><normalized-reference>1147.130.217.140.56.1193787099.squirrel@webmail.treenet.co.nz</normalized-reference></normalized-references><body type="text/plain; charset=us-ascii"><para depth="0">On Wed, 31 Oct 2007 12:31:39 +1300 (NZDT)
"Amos Jeffries" &lt;<email>squid3@treenet.co.nz</email>&gt; wrote:

</para><quote depth="1"><quote depth="2"><quotepara depth="2">Hi there:
I'm having some problems understanding how the refresh_pattern
options works.
The Squid guide says:

</quotepara><quotepara depth="2">FRESH    if expires &lt; now, else STALE
STALE     if age &gt; max
FRESH    if lm-factor &lt; percent, else STALE
FRESH    if age &lt; min
else         STALE

</quotepara><quotepara depth="2">Min:
time (in minutes), an object without an explicit expire time should
be considered fresh.

</quotepara><quotepara depth="2">Percent:
percentage of the objects age (time since last modification age) an
object without explicit expire time will be considered fresh.

</quotepara><quotepara depth="2">Max:
upper limit on how long objects without an explicit expiry time will
be considered fresh.

</quotepara><quotepara depth="2">So, my question is this; if the object's age is between Min and Max,
is it STALE or FRESH?
</quotepara></quote><quotepara depth="1">
That logic says STALE (!&lt;min ... choosing else).
</quotepara></quote><para depth="0">
No it doesn't, you have to follow the pseudocode through until you get a
STALE/FRESH result, and then stop. If you can compute an lm-factor,
then the "age &lt; min" line can't be reached.

</para><para depth="0">Objects without an LM time cannot be refreshed, they have to be
refetched; without a min setting such objects would not be cached at
all.

</para><quote depth="1"><quotepara depth="1">IMHO, Max is there because max-age (given by server) CAN be less than
min (configured).
</quotepara></quote><para depth="0">
"max" is ignored if the server supplies an expiry time, it's there to
provide an upper-limit to how long a object can be kept fresh by its 
lm-factor. 

</para><para depth="0">There are basically three classes of object:

</para><para depth="0">1. with explicit expiry information (max/min/percent are ignored)

</para><para depth="0">2. with LM, but no expiry - governed by percent and max.

</para><para depth="0">3  with neither  - governed by min

</para><para depth="0">( Note that all of the above assumes that no refresh rule override
options have been set.)

</para></body></message>