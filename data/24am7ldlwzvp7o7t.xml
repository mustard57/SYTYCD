<message message-id="20021207022253.GA69717@rot13.obsecurity.org" list="org.freebsd.freebsd-current" id="24am7ldlwzvp7o7t" type="general" date="2002-12-06T18:22:53-08:00" year="2002-01-01" year-month="2002-12-01" year-month-day="2002-12-06" thread-id="xsjygcpzjhfuuj7a"><headers><envelope-from-line>From owner-freebsd-current  Fri Dec  6 18:22:56 2002</envelope-from-line><from personal="Kris Kennaway" address="kris@obsecurity.org">Kris Kennaway &lt;kris@obsecurity.org&gt;</from><to personal="Lars Eggert" address="larse@ISI.EDU">Lars Eggert &lt;larse@ISI.EDU&gt;</to><cc personal="current@FreeBSD.ORG" address="current@FreeBSD.ORG">current@FreeBSD.ORG</cc><subject normal="LOR: filedesc structure -&gt; pipe mutex">Re: LOR: filedesc structure -&gt; pipe mutex</subject><delivered-to>freebsd-current@freebsd.org</delivered-to><received>from mx1.FreeBSD.org (mx1.freebsd.org [216.136.204.125])
	by hub.freebsd.org (Postfix) with ESMTP id 5824D37B401
	for &lt;current@FreeBSD.ORG&gt;; Fri,  6 Dec 2002 18:22:55 -0800 (PST)</received><received>from obsecurity.dyndns.org (adsl-64-169-104-228.dsl.lsan03.pacbell.net [64.169.104.228])
	by mx1.FreeBSD.org (Postfix) with ESMTP id 5CC1043ECF
	for &lt;current@FreeBSD.ORG&gt;; Fri,  6 Dec 2002 18:22:54 -0800 (PST)
	(envelope-from kris@obsecurity.org)</received><received>from rot13.obsecurity.org (rot13.obsecurity.org [10.0.0.5])
	by obsecurity.dyndns.org (Postfix) with ESMTP
	id CF6E566BE3; Fri,  6 Dec 2002 18:22:53 -0800 (PST)</received><received>by rot13.obsecurity.org (Postfix, from userid 1000)
	id 824961377; Fri,  6 Dec 2002 18:22:53 -0800 (PST)</received><date>Fri, 6 Dec 2002 18:22:53 -0800</date><message-id>20021207022253.GA69717@rot13.obsecurity.org</message-id><references>&lt;3DF12681.8020008@isi.edu&gt;</references><mime-version>1.0</mime-version><content-type>text/plain; charset=us-ascii</content-type><content-disposition>inline</content-disposition><in-reply-to>&lt;3DF12681.8020008@isi.edu&gt;</in-reply-to><user-agent>Mutt/1.4i</user-agent><sender>owner-freebsd-current@FreeBSD.ORG</sender><precedence>bulk</precedence><list-id>&lt;freebsd-current.FreeBSD.ORG&gt;</list-id><list-archive>&lt;http://docs.freebsd.org/mail/&gt; (Web Archive)</list-archive><list-help>&lt;mailto:majordomo@FreeBSD.ORG?subject=help&gt; (List Instructions)</list-help><list-subscribe>&lt;mailto:majordomo@FreeBSD.ORG?subject=subscribe%20freebsd-current&gt;</list-subscribe><list-unsubscribe>&lt;mailto:majordomo@FreeBSD.ORG?subject=unsubscribe%20freebsd-current&gt;</list-unsubscribe><x-loop>FreeBSD.ORG</x-loop></headers><normalized-references><normalized-message-id>20021207022253.GA69717@rot13.obsecurity.org</normalized-message-id><normalized-in-reply-to>3DF12681.8020008@isi.edu</normalized-in-reply-to><normalized-reference>3DF12681.8020008@isi.edu</normalized-reference></normalized-references><body type="text/plain; charset=us-ascii"><para depth="0">On Fri, Dec 06, 2002 at 02:36:49PM -0800, Lars Eggert wrote:
</para><quote depth="1"><quotepara depth="1">On today's -current:

</quotepara><quotepara depth="1">lock order reversal
 1st 0xc6948234 filedesc structure (filedesc structure) @ 
/usr/src/sys/kern/sys_generic.c:901
 2nd 0xc691f380 pipe mutex (pipe mutex) @ /usr/src/sys/kern/sys_pipe.c:1239

</quotepara><quotepara depth="1">Debugger("witness_lock")
Stopped at      Debugger+0x5a:  xchgl   %ebx,in_Debugger.0

</quotepara><quotepara depth="1">db&gt; trace

</quotepara><quotepara depth="1">Debugger(c0320e4d,c691f380,c0341c32,c0341c32,c0342671) at Debugger+0x5a
witness_lock(c691f380,8,c0342671,4d7,c01f3b4a) at witness_lock+0x142
_mtx_lock_flags(c691f380,0,c0342671,4d7,c65c76cc) at _mtx_lock_flags+0x63
pipe_poll(c65c76cc,40,c21af180,c65d3460,c21af180) at pipe_poll+0x3d
selscan(c65d3460,eb36ab90,eb36ab80,14,4) at selscan+0xdf
kern_select(c65d3460,14,804c940,0,0) at kern_select+0x41f
select(c65d3460,eb36ad10,c035adb4,407,c65d27c8) at select+0x42
syscall(2f,2f,2f,804c9c0,804c8a0) at syscall+0x3c6
Xint0x80_syscall() at Xint0x80_syscall+0x1d
--- syscall (93, FreeBSD ELF32, select), eip = 0x280b3853, esp = 
0xbfbff90c, ebp = 0xbfbffd60 ---
</quotepara></quote><para depth="0">
I'm getting this too:

</para><para depth="0">Local package initialization:lock order reversal
 1st 0xc449ad34 filedesc structure (filedesc structure) @<br/>/local0/src-client/sys/kern/sys_generic.c:901
 2nd 0xc4146780 pipe mutex (pipe mutex) @<br/>/local0/src-client/sys/kern/sys_pipe.c:1239
Debugger("witness_lock")
Stopped at      Debugger+0x54:  xchgl   %ebx,in_Debugger.0
db&gt; trace
Debugger(c03efc85,c4146780,c04192dc,c04192dc,c0419d33) at Debugger+0x54
witness_lock(c4146780,8,c0419d33,4d7,c0291b89) at witness_lock+0x667
_mtx_lock_flags(c4146780,0,c0419d33,4d7,c418b4ec) at _mtx_lock_flags+0xb1
pipe_poll(c418b4ec,40,c420ad00,c3f5cb60,c420ad00) at pipe_poll+0x40
selscan(c3f5cb60,d7a29b98,d7a29b88,7,4) at selscan+0x12e
kern_select(c3f5cb60,7,8076190,0,0) at kern_select+0x36f
select(c3f5cb60,d7a29d10,c043094c,407,5) at select+0x66
syscall(2f,2f,2f,8076190,1e) at syscall+0x28e
Xint0x80_syscall() at Xint0x80_syscall+0x1d
--- syscall (93, FreeBSD ELF32, select), eip = 0x2829a433, esp = 0xbfbff4dc, ebp<br/>= 0xbfbffda0 ---
db&gt;

</para><para depth="0">Kris

</para><para depth="0">To Unsubscribe: send mail to <email>majordomo@FreeBSD.org</email>
with "unsubscribe freebsd-current" in the body of the message

</para></body></message>