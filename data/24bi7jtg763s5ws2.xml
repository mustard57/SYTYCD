<message message-id="20080922151725.AC88E238896D@eris.apache.org" list="org.apache.ofbiz.commits" id="24bi7jtg763s5ws2" type="checkins" date="2008-09-22T15:17:25Z" year="2008-01-01" year-month="2008-09-01" year-month-day="2008-09-22" thread-id="24bi7jtg763s5ws2"><headers><envelope-from-line>Mon Sep 22 08:18:17 2008</envelope-from-line><from personal="doogie@apache.org" address="doogie@apache.org">doogie@apache.org</from><to personal="commits@ofbiz.apache.org" address="commits@ofbiz.apache.org">commits@ofbiz.apache.org</to><subject normal="svn commit: r697866 - /ofbiz/trunk/framework/start/src/org/ofbiz/base/start/Start.java">svn commit: r697866 - /ofbiz/trunk/framework/start/src/org/ofbiz/base/start/Start.java</subject><received>from srv-117c-be06.markmail.marklogic.com ([172.19.8.46])
          by mail-1.a.markmail.int (JAMES SMTP Server 2.3.1) with SMTP ID 366
          for &lt;estela.vaughn.flynn@a.markmail.org&gt;;
          Mon, 22 Sep 2008 08:18:17 -0700 (PDT)</received><received>from mail.apache.org (slb-117n.markmail.marklogic.com [172.19.8.33])
	by mgw-1.public.markmail.int (Postfix) with SMTP id AFD232908053
	for &lt;estela.vaughn.flynn@a.markmail.org&gt;; Mon, 22 Sep 2008 08:18:16 -0700 (PDT)</received><received>(qmail 83483 invoked by uid 500); 22 Sep 2008 15:18:13 -0000</received><mailing-list>contact commits-help@ofbiz.apache.org; run by ezmlm</mailing-list><precedence>bulk</precedence><list-help>&lt;mailto:commits-help@ofbiz.apache.org&gt;</list-help><list-unsubscribe>&lt;mailto:commits-unsubscribe@ofbiz.apache.org&gt;</list-unsubscribe><list-post>&lt;mailto:commits@ofbiz.apache.org&gt;</list-post><list-id>&lt;commits.ofbiz.apache.org&gt;</list-id><reply-to>dev@ofbiz.apache.org</reply-to><delivered-to>mailing list commits@ofbiz.apache.org</delivered-to><received>(qmail 83474 invoked by uid 99); 22 Sep 2008 15:18:13 -0000</received><received>from athena.apache.org (HELO athena.apache.org) (140.211.11.136)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Sep 2008 08:18:13 -0700</received><x-asf-spam-status>No, hits=-2000.0 required=10.0
	tests=ALL_TRUSTED</x-asf-spam-status><x-spam-check-by>apache.org</x-spam-check-by><received>from [140.211.11.4] (HELO eris.apache.org) (140.211.11.4)
    by apache.org (qpsmtpd/0.29) with ESMTP; Mon, 22 Sep 2008 15:17:22 +0000</received><received>by eris.apache.org (Postfix, from userid 65534)
	id AC88E238896D; Mon, 22 Sep 2008 08:17:25 -0700 (PDT)</received><content-type>text/plain; charset="utf-8"</content-type><mime-version>1.0</mime-version><content-transfer-encoding>7bit</content-transfer-encoding><date>Mon, 22 Sep 2008 15:17:25 -0000</date><x-mailer>svnmailer-1.0.8</x-mailer><message-id>20080922151725.AC88E238896D@eris.apache.org</message-id><x-virus-checked>Checked by ClamAV on apache.org</x-virus-checked></headers><normalized-references><normalized-message-id>20080922151725.AC88E238896D@eris.apache.org</normalized-message-id></normalized-references><body type="text/plain; charset=&quot;utf-8&quot;"><para depth="0">Author: doogie
Date: Mon Sep 22 08:17:25 2008
New Revision: 697866

</para><para depth="0">URL: <url>http://svn.apache.org/viewvc?rev=697866&amp;view=rev</url>
Log:
Refactored a little bit.

</para><para depth="0">Modified:
    ofbiz/trunk/framework/start/src/org/ofbiz/base/start/Start.java

</para><para depth="0">Modified: ofbiz/trunk/framework/start/src/org/ofbiz/base/start/Start.java
URL:<br/><url>http://svn.apache.org/viewvc/ofbiz/trunk/framework/start/src/org/ofbiz/base/start/Start.java?rev=697866&amp;r1=697865&amp;r2=697866&amp;view=diff</url>
==============================================================================
--- ofbiz/trunk/framework/start/src/org/ofbiz/base/start/Start.java (original)
+++ ofbiz/trunk/framework/start/src/org/ofbiz/base/start/Start.java Mon Sep 22<br/>08:17:25 2008
@@ -488,6 +488,18 @@
             return props;
         }

</para><para depth="0">+        private String getOfbizHomeProp(Properties props, String key, String<br/>def) {
+            String value = System.getProperty(key);
+            if (value != null) return value;
+            return ofbizHome + "/" + props.getProperty(key, def);
+        }
+
+        private String getProp(Properties props, String key, String def) {
+            String value = System.getProperty(key);
+            if (value != null) return value;
+            return props.getProperty(key, def);
+        }
+
         public void readConfig(String config) throws IOException {
             // check the java_version
             String javaVersion = System.getProperty("java.version");
@@ -516,73 +528,40 @@
             System.setProperty("ofbiz.home", ofbizHome);

</para><para depth="0">             // base config directory
-            baseConfig = System.getProperty("ofbiz.base.config");
-            if (baseConfig == null) {
-                baseConfig = ofbizHome + "/" +<br/>props.getProperty("ofbiz.base.config", "framework/base/config");
-            }
+            baseConfig = getOfbizHomeProp(props, "ofbiz.base.config",<br/>"framework/base/config");

</para><para depth="0">             // base schema directory
-            baseDtd = System.getProperty("ofbiz.base.schema");
-            if (baseDtd == null) {
-                baseDtd = ofbizHome + "/" +<br/>props.getProperty("ofbiz.base.schema", "framework/base/dtd");
-            }
+            baseDtd = getOfbizHomeProp(props, "ofbiz.base.schema",<br/>"framework/base/dtd");

</para><para depth="0">             // base lib directory
-            baseLib = System.getProperty("ofbiz.base.lib");
-            if (baseLib == null) {
-                baseLib = ofbizHome + "/" + props.getProperty("ofbiz.base.lib",<br/>"framework/base/lib");
-            }
+            baseLib = getOfbizHomeProp(props, "ofbiz.base.lib",<br/>"framework/base/lib");

</para><para depth="0">             // base jar file
-            baseJar = System.getProperty("ofbiz.base.jar");
-            if (baseJar == null) {
-                baseJar = ofbizHome + "/" + props.getProperty("ofbiz.base.jar",<br/>"framework/base/build/lib/ofbiz-base.jar");
-            }
+            baseJar = getOfbizHomeProp(props, "ofbiz.base.jar",<br/>"framework/base/build/lib/ofbiz-base.jar");

</para><para depth="0">             // tools jar
-            String reqTJ = System.getProperty("java.tools.jar.required");
-            if (reqTJ == null) {
-                reqTJ = props.getProperty("java.tools.jar.required", "false");
-            }
+            String reqTJ = getProp(props, "java.tools.jar.required", "false");
             requireToolsJar = "true".equalsIgnoreCase(reqTJ);
             toolsJar = this.findSystemJar(props, javaVendor, javaVersion,<br/>"tools.jar", requireToolsJar);

</para><para depth="0">             // comm jar
-            String reqCJ = System.getProperty("java.comm.jar.required");
-            if (reqTJ == null) {
-                reqTJ = props.getProperty("java.comm.jar.required", "false");
-            }
+            String reqCJ = getProp(props, "java.comm.jar.required", "false");
             requireCommJar = "true".equalsIgnoreCase(reqCJ);
             commJar = this.findSystemJar(props, javaVendor, javaVersion,<br/>"comm.jar", requireCommJar);

</para><para depth="0">             // log directory
-            logDir = System.getProperty("ofbiz.log.dir");
-            if (logDir == null) {
-                logDir = ofbizHome + "/" + props.getProperty("ofbiz.log.dir",<br/>"runtime/logs");
-            }
+            logDir = getOfbizHomeProp(props, "ofbiz.log.dir", "runtime/logs");

</para><para depth="0">             // container configuration
-            containerConfig = System.getProperty("ofbiz.container.config");
-            if (containerConfig == null) {
-                containerConfig = ofbizHome + "/" +<br/>props.getProperty("ofbiz.container.config",<br/>"framework/base/config/ofbiz-containers.xml");
-            }
+            containerConfig = getOfbizHomeProp(props, "ofbiz.container.config",<br/>"framework/base/config/ofbiz-containers.xml");

</para><para depth="0">             // get the admin server info
-            String serverHost = System.getProperty("ofbiz.admin.host");
-            if (serverHost == null) {
-                serverHost = props.getProperty("ofbiz.admin.host",<br/>"127.0.0.1");
-            }
+            String serverHost = getProp(props, "ofbiz.admin.host",<br/>"127.0.0.1");

</para><para depth="0">-            String adminPortStr = System.getProperty("ofbiz.admin.port");
-            if (adminPortStr == null) {
-                adminPortStr = props.getProperty("ofbiz.admin.port", "0");
-            }
+            String adminPortStr = getProp(props, "ofbiz.admin.port", "0");

</para><para depth="0">             // set the admin key
-            adminKey = System.getProperty("ofbiz.admin.key");
-            if (adminKey == null) {
-                adminKey = props.getProperty("ofbiz.admin.key", "NA");
-            }
+            String adminKey = getProp(props, "ofbiz.admin.key", "NA");

</para><para depth="0">             // create the host InetAddress
             adminAddress = InetAddress.getByName(serverHost);
@@ -595,22 +574,11 @@
             }

</para><para depth="0">             // set the Derby system home
-            String derbyPath = System.getProperty("derby.system.home");
-            if (derbyPath == null) {
-                derbyPath = props.getProperty("derby.system.home",<br/>"runtime/data/derby");
-            }
+            String derbyPath = getProp(props, "derby.system.home",<br/>"runtime/data/derby");
             System.setProperty("derby.system.home", derbyPath);

</para><para depth="0">             // set the property to tell Log4J to use log4j.xml
-            String log4jConfig = System.getProperty("log4j.configuration");
-            if (log4jConfig == null) {
-                log4jConfig = props.getProperty("log4j.configuration");
-            }
-
-            // build a default log4j configuration based on ofbizHome
-            if (log4jConfig == null) {
-                log4jConfig = "log4j.xml";
-            }
+            String log4jConfig = getProp(props, "log4j.configuration",<br/>"log4j.xml");

</para><para depth="0">             // set the log4j configuration property so we don't pick up one<br/>inside jars by mistake
             System.setProperty("log4j.configuration", log4jConfig);
@@ -630,10 +598,7 @@
             }

</para><para depth="0">             // set AWT headless mode
-            awtHeadless = System.getProperty("java.awt.headless");
-            if (awtHeadless == null) {
-                awtHeadless = props.getProperty("java.awt.headless");
-            }
+            awtHeadless = getProp(props, "java.awt.headless", null);
             if (awtHeadless != null) {
                 System.setProperty("java.awt.headless", awtHeadless);
             }

</para></body></message>