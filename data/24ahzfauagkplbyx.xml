<message message-id="201108021334.p72DYuK08048@momjian.us" list="org.postgresql.pgsql-hackers" id="24ahzfauagkplbyx" type="development" date="2011-08-02T05:34:54.819306-08:00" year="2011-01-01" year-month="2011-08-01" year-month-day="2011-08-02" thread-id="24ahzfauagkplbyx"><headers><envelope-from-line>Tue Aug 02 05:35:17 2011</envelope-from-line><from personal="Bruce Momjian" address="bruce@momjian.us">Bruce Momjian &lt;bruce@momjian.us&gt;</from><to personal="PostgreSQL-development" address="pgsql-hackers@postgreSQL.org">PostgreSQL-development &lt;pgsql-hackers@postgreSQL.org&gt;</to><subject normal="[HACKERS] WAL logging volume and CREATE TABLE">[HACKERS] WAL logging volume and CREATE TABLE</subject><received>from srv-117c-be06.markmail.marklogic.com ([172.19.8.46])
          by mail-1.a.markmail.int (JAMES SMTP Server 2.3.1) with SMTP ID 194
          for &lt;juan.avila.conrad@a.markmail.org&gt;;
          Tue, 2 Aug 2011 05:35:17 -0800 (GMT-08:00)</received><received>from mx1.hub.org (slb-117n.markmail.marklogic.com [172.19.8.33])
	by mgw-1.public.markmail.int (Postfix) with ESMTP id 6CD6529081D1
	for &lt;juan.avila.conrad@a.markmail.org&gt;; Tue,  2 Aug 2011 06:34:54 -0700 (PDT)</received><received>from postgresql.org (mail.postgresql.org [200.46.204.86])
	by mx1.hub.org (Postfix) with ESMTP id 7208327FBA87;
	Tue,  2 Aug 2011 10:35:15 -0300 (ADT)</received><received>from maia.hub.org (maia-2.hub.org [200.46.204.251])
	by mail.postgresql.org (Postfix) with ESMTP id C4932B5DBC5
	for &lt;pgsql-hackers-postgresql.org@mail.postgresql.org&gt;; Tue,  2 Aug 2011 10:35:02 -0300 (ADT)</received><received>from mail.postgresql.org ([200.46.204.86])
 by maia.hub.org (mx1.hub.org [200.46.204.251]) (amavisd-maia, port 10024)
 with ESMTP id 38969-05
 for &lt;pgsql-hackers-postgresql.org@mail.postgresql.org&gt;;
 Tue,  2 Aug 2011 13:34:56 +0000 (UTC)</received><x-greylist>from auto-whitelisted by SQLgrey-1.7.6</x-greylist><received>from momjian.us (momjian.us [70.90.9.53])
	by mail.postgresql.org (Postfix) with ESMTP id EE80FB5DBBF
	for &lt;pgsql-hackers@postgreSQL.org&gt;; Tue,  2 Aug 2011 10:34:55 -0300 (ADT)</received><received>(from bruce@localhost)
	by momjian.us (8.11.6/8.11.6) id p72DYuK08048
	for pgsql-hackers@postgreSQL.org; Tue, 2 Aug 2011 09:34:56 -0400 (EDT)</received><message-id>201108021334.p72DYuK08048@momjian.us</message-id><date>Tue, 2 Aug 2011 09:34:56 -0400 (EDT)</date><x-mailer>ELM [version 2.4ME+ PL124 (25)]</x-mailer><mime-version>1.0</mime-version><content-transfer-encoding>7bit</content-transfer-encoding><content-type>text/plain; charset="US-ASCII"</content-type><x-virus-scanned>Maia Mailguard 1.0.1</x-virus-scanned><x-spam-status>No, hits=-2.706 tagged_above=-5 required=5 tests=BAYES_00=-1.9,
 RP_MATCHES_RCVD=-0.806</x-spam-status><x-spam-level/><x-mailing-list>pgsql-hackers</x-mailing-list><list-archive>&lt;http://archives.postgresql.org/pgsql-hackers&gt;</list-archive><list-help>&lt;mailto:majordomo@postgresql.org?body=help&gt;</list-help><list-id>&lt;pgsql-hackers.postgresql.org&gt;</list-id><list-owner>&lt;mailto:pgsql-hackers-owner@postgresql.org&gt;</list-owner><list-post>&lt;mailto:pgsql-hackers@postgresql.org&gt;</list-post><list-subscribe>&lt;mailto:majordomo@postgresql.org?body=sub%20pgsql-hackers&gt;</list-subscribe><list-unsubscribe>&lt;mailto:majordomo@postgresql.org?body=unsub%20pgsql-hackers&gt;</list-unsubscribe><precedence>bulk</precedence><sender>pgsql-hackers-owner@postgresql.org</sender></headers><normalized-references><normalized-message-id>201108021334.p72DYuK08048@momjian.us</normalized-message-id></normalized-references><body type="text/plain; charset=&quot;us-ascii&quot;"><para depth="0">Our docs suggest an optimization to reduce WAL logging when you are
creating and populating a table:

</para><para depth="0">	<url>http://www.postgresql.org/docs/9.0/static/runtime-config-wal.html#RUNTIME-CONFIG-WAL-SETTINGS</url>

</para><para depth="0">	In minimal level, WAL-logging of some bulk operations, like CREATE
	INDEX, CLUSTER and COPY on a table that was created or truncated in the
	same transaction can be safely skipped, which can make those operations
	much faster (see Section 14.4.7). But minimal WAL does not contain
	enough information to reconstruct the data from a base backup and the
	WAL logs, so either archive or hot_standby level must be used to enable
	WAL archiving (archive_mode) and streaming replication.

</para><para depth="0">I am confused why we issue significant WAL traffic for CREATE INDEX? 
Isn't the index either created or removed if the transaction fails? 
What crash recovery activity state do we need WAL logging for?  I
realize we have to do WAL logging for streaming replication, but CREATE
TABLE isn't going to affect that.   I also realize the index has to be
on disk on commit, but the same is true for doing the CREATE TABLE in
the same transaction block.

</para><para depth="0">Does this optimization work for INSERT ... SELECT? Is this optimization
automatic for CREATE TABLE AS (SELECT INTO)?

</para><footer type="signature" depth="0" hash="18301643957463875843">-- 
  Bruce Momjian  &lt;<email>bruce@momjian.us</email>&gt;        <url>http://momjian.us</url>
  EnterpriseDB                             <url>http://enterprisedb.com</url>

</footer><para depth="0">  + It's impossible for everything to be true. +

</para><footer type="list-management" depth="0">-- 
Sent via pgsql-hackers mailing list (<email>pgsql-hackers@postgresql.org</email>)
To make changes to your subscription:
<url>http://www.postgresql.org/mailpref/pgsql-hackers</url>
</footer></body></message>