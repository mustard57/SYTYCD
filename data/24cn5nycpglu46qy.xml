<message message-id="200801301953.m0UJrECm032520@cvs-int.fedora.redhat.com" list="com.redhat.fedora-extras-commits" id="24cn5nycpglu46qy" type="checkins" date="2008-01-30T14:53:14-05:00" year="2008-01-01" year-month="2008-01-01" year-month-day="2008-01-30" thread-id="24cn5nycpglu46qy"><headers><envelope-from-line>From accounts@fedoraproject.org Wed Jan 30 14:53:21 2008</envelope-from-line><from personal="Jarod Wilson (jwilson)" address="fedora-extras-commits@redhat.com">"Jarod Wilson (jwilson)" &lt;fedora-extras-commits@redhat.com&gt;</from><to personal="fedora-extras-commits@redhat.com" address="fedora-extras-commits@redhat.com">fedora-extras-commits@redhat.com</to><subject normal="rpms/libraw1394/devel libraw1394-juju-bitfield-update.patch, NONE, 1.1 libraw1394.spec, 1.38, 1.39 firewire-cdev.h, 1.3, NONE">rpms/libraw1394/devel libraw1394-juju-bitfield-update.patch, NONE,  1.1 libraw1394.spec, 1.38, 1.39 firewire-cdev.h, 1.3, NONE</subject><received>from int-mx1.corp.redhat.com (int-mx1.corp.redhat.com
	[172.16.52.254])
	by listman.util.phx.redhat.com (8.13.1/8.13.1) with ESMTP id
	m0UJrK2m019968
	for &lt;fedora-extras-commits@listman.util.phx.redhat.com&gt;;
	Wed, 30 Jan 2008 14:53:21 -0500</received><received>from mx1.util.phx.redhat.com (mx1.util.phx.redhat.com [10.8.4.92])
	by int-mx1.corp.redhat.com (8.13.1/8.13.1) with ESMTP id m0UJrK9F024486
	for &lt;fedora-extras-commits@int-mx1.corp.redhat.com&gt;;
	Wed, 30 Jan 2008 14:53:20 -0500</received><received>from bastion.fedora.phx.redhat.com (bastion.fedora.phx.redhat.com
	[10.8.34.50])
	by mx1.util.phx.redhat.com (8.13.1/8.13.1) with ESMTP id m0UJrEmu004890
	for &lt;fedora-extras-commits@redhat.com&gt;; Wed, 30 Jan 2008 14:53:14 -0500</received><received>from bastion.fedora.phx.redhat.com (localhost.localdomain
	[127.0.0.1])
	by bastion.fedora.phx.redhat.com (8.13.8/8.13.8) with ESMTP id
	m0UJrEdQ013341
	for &lt;fedora-extras-commits@redhat.com&gt;; Wed, 30 Jan 2008 12:53:14 -0700</received><received>(from accounts@localhost)
	by bastion.fedora.phx.redhat.com (8.13.8/8.13.8/Submit) id
	m0UJrEHN013340
	for fedora-extras-commits@redhat.com; Wed, 30 Jan 2008 12:53:14 -0700</received><received>from cvs-int.fedora.redhat.com (cvs.fedoraproject.org [10.8.34.51])
	by bastion.fedora.phx.redhat.com (8.13.8/8.13.8) with ESMTP id
	m0UJrE0k013329; Wed, 30 Jan 2008 12:53:14 -0700</received><received>from cvs-int.fedora.phx.redhat.com (localhost.localdomain
	[127.0.0.1])
	by cvs-int.fedora.redhat.com (8.13.1/8.13.1) with ESMTP id
	m0UJrECm032520; Wed, 30 Jan 2008 14:53:14 -0500</received><date>Wed, 30 Jan 2008 14:53:14 -0500</date><message-id>200801301953.m0UJrECm032520@cvs-int.fedora.redhat.com</message-id><x-cvsroot>/cvs/pkgs</x-cvsroot><old-from>Jarod Wilson &lt;jwilson@fedoraproject.org&gt;</old-from><x-cvs-module>rpms</x-cvs-module><x-cvs-directory>rpms/libraw1394/devel</x-cvs-directory><x-cvs-user>jwilson</x-cvs-user><x-cvs-server>cvs-int.fedora.redhat.com</x-cvs-server><precedence>first-class</precedence><x-scanned-by>MIMEDefang 2.58 on 172.16.52.254</x-scanned-by><x-loop>fedora-extras-commits@redhat.com</x-loop><x-topics>Package Commits</x-topics><x-beenthere>fedora-extras-commits@redhat.com</x-beenthere><x-mailman-version>2.1.5</x-mailman-version><reply-to>fedora-devel-list@redhat.com</reply-to><list-id>Fedora Extras CVS commits &lt;fedora-extras-commits.redhat.com&gt;</list-id><list-unsubscribe>&lt;https://www.redhat.com/mailman/listinfo/fedora-extras-commits&gt;,
	&lt;mailto:fedora-extras-commits-request@redhat.com?subject=unsubscribe&gt;</list-unsubscribe><list-archive>&lt;https://www.redhat.com/archives/fedora-extras-commits&gt;</list-archive><list-post>&lt;mailto:fedora-extras-commits@redhat.com&gt;</list-post><list-help>&lt;mailto:fedora-extras-commits-request@redhat.com?subject=help&gt;</list-help><list-subscribe>&lt;https://www.redhat.com/mailman/listinfo/fedora-extras-commits&gt;,
	&lt;mailto:fedora-extras-commits-request@redhat.com?subject=subscribe&gt;</list-subscribe><x-list-received-date>Wed, 30 Jan 2008 19:53:21 -0000</x-list-received-date><content-type>text/plain; charset=iso-8859-1</content-type><mime-version>1.0</mime-version></headers><normalized-references><normalized-message-id>200801301953.m0UJrECm032520@cvs-int.fedora.redhat.com</normalized-message-id></normalized-references><body type="text/plain; charset=iso-8859-1"><para depth="0">Author: jwilson

</para><para depth="0">Update of /cvs/pkgs/rpms/libraw1394/devel
In directory cvs-int.fedora.redhat.com:/tmp/cvs-serv32495

</para><para depth="0">Modified Files:
	libraw1394.spec 
Added Files:
	libraw1394-juju-bitfield-update.patch 
Removed Files:
	firewire-cdev.h 
Log Message:
* Wed Jan 30 2008 Jarod Wilson &lt;<email>jwilson@redhat.com</email>&gt; - 1.3.0-4
- Use firewire-cdev.h provided by kernel-headers

</para><para depth="0">libraw1394-juju-bitfield-update.patch:

</para><para depth="0">--- NEW FILE libraw1394-juju-bitfield-update.patch ---
diff -Naurp libraw1394-1.3.0/juju/juju.h libraw1394-1.3.0.bitfield/juju/juju.h
--- libraw1394-1.3.0/juju/juju.h	2007-10-24 16:47:26.000000000 -0400
+++ libraw1394-1.3.0.bitfield/juju/juju.h	2007-10-24 16:50:47.000000000 -0400
@@ -29,8 +29,6 @@
 #include "../src/csr.h"
 #include "config.h"

</para><para depth="0">-#define ACK_COMPLETE 1
-
 #define ptr_to_u64(p) ((__u64)(unsigned long)(p))
 #define u64_to_ptr(p) ((void *)(unsigned long)(p))

</para><para depth="0">diff -Naurp libraw1394-1.3.0/juju/raw1394-iso.c<br/>libraw1394-1.3.0.bitfield/juju/raw1394-iso.c
--- libraw1394-1.3.0/juju/raw1394-iso.c	2007-10-24 16:47:26.000000000 -0400
+++ libraw1394-1.3.0.bitfield/juju/raw1394-iso.c	2007-10-24 16:53:06.000000000<br/>-0400
@@ -40,13 +40,14 @@ queue_packet(raw1394handle_t handle,
 	int err;

</para><para depth="0"> 	p = &amp;handle-&gt;iso.packets[handle-&gt;iso.packet_index];
-	p-&gt;payload_length = length;
-	p-&gt;interrupt =
-		handle-&gt;iso.packet_phase == handle-&gt;iso.irq_interval - 1;
-	p-&gt;skip = 0;
-	p-&gt;tag = tag;
-	p-&gt;sy = sy;
-	p-&gt;header_length = header_length;
+	p-&gt;control =
+		FW_CDEV_ISO_PAYLOAD_LENGTH(length) |
+		FW_CDEV_ISO_TAG(tag) |
+		FW_CDEV_ISO_SY(sy) |
+		FW_CDEV_ISO_HEADER_LENGTH(header_length);
+
+	if (handle-&gt;iso.packet_phase == handle-&gt;iso.irq_interval - 1)
+		p-&gt;control |= FW_CDEV_ISO_INTERRUPT;

</para><para depth="0"> 	handle-&gt;iso.head += length;
 	handle-&gt;iso.packet_count++;
@@ -291,12 +292,7 @@ int raw1394_iso_xmit_sync(raw1394handle_
 	struct fw_cdev_queue_iso queue_iso;
 	int len;

</para><para depth="0">-	skip.payload_length = 0;
-	skip.interrupt = 1;
-	skip.skip = 1;
-	skip.tag = 0;
-	skip.sy = 0;
-	skip.header_length = 0;
+	skip.control = FW_CDEV_ISO_INTERRUPT | FW_CDEV_ISO_SKIP;

</para><para depth="0"> 	queue_iso.packets = ptr_to_u64(&amp;skip);
 	queue_iso.size    = sizeof skip;

</para><para depth="0">Index: libraw1394.spec
===================================================================
RCS file: /cvs/pkgs/rpms/libraw1394/devel/libraw1394.spec,v
retrieving revision 1.38
retrieving revision 1.39
diff -u -r1.38 -r1.39
--- libraw1394.spec	24 Oct 2007 20:10:53 -0000	1.38
+++ libraw1394.spec	30 Jan 2008 19:52:39 -0000	1.39
@@ -1,18 +1,18 @@
 Summary:        Library providing low-level IEEE-1394 access
 Name:           libraw1394
 Version:        1.3.0
-Release:        3%{?dist}
+Release:        4%{?dist}
 License:        LGPL
 Group:          System Environment/Libraries
 Source:         <url>http://www.linux1394.org/dl/libraw1394-%</url>{version}.tar.gz
 URL:            <url>http://www.linux1394.org/</url>
 ExcludeArch:    s390 s390x
 BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
-BuildRequires:	autoconf automake libtool
+BuildRequires:	autoconf automake libtool kernel-headers

</para><para depth="0">-Source1:        firewire-cdev.h
 Patch0:         libraw1394-juju.patch
 Patch1:         libraw1394-juju-no-double-free-on-shutdown.patch
+Patch2:         libraw1394-juju-bitfield-update.patch

</para><para depth="0"> %description
 The libraw1394 library provides direct access to the IEEE-1394 bus through
@@ -31,14 +31,9 @@

</para><para depth="0"> %patch0 -p1 -b .juju
 %patch1 -p1 -b .free
+%patch2 -p1 -b .bitf

</para><para depth="0"> %build
-
-if test ! -e %{_builddir}/linux/firewire-cdev.h; then
-	mkdir %{_builddir}/linux
-	cp %{_sourcedir}/firewire-cdev.h %{_builddir}/linux
-fi
-
 aclocal
 autoheader
 autoconf
@@ -79,8 +74,12 @@

</para><para depth="0"> %changelog
+* Wed Jan 30 2008 Jarod Wilson &lt;<email>jwilson@redhat.com</email>&gt; - 1.3.0-4
+- Use firewire-cdev.h provided by kernel-headers
+
 * Wed Oct 24 2007 Jarod Wilson &lt;<email>jwilson@redhat.com</email>&gt; - 1.3.0-3
-- Update firewire-cdev.h to match kernel
+- Update firewire-cdev.h to match kernel and eliminate
+  bitfield usage, fixes capture on big-endian systems (#345221)

</para><para depth="0"> * Fri Oct 19 2007 Jarod Wilson &lt;<email>jwilson@redhat.com</email>&gt; - 1.3.0-2
 - Fix the 'double free' crash on shutdown (#328011)

</para><para depth="0">--- firewire-cdev.h DELETED ---
</para></body></message>