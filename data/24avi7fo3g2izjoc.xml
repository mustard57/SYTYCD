<message message-id="200601232041.19159.thierry@herbelot.com" list="org.freebsd.freebsd-current" id="24avi7fo3g2izjoc" type="general" date="2006-01-23T12:13:03" year="2006-01-01" year-month="2006-01-01" year-month-day="2006-01-23" thread-id="s44hia4ynrplebt3"><headers><envelope-from-line>From thierry@herbelot.com  Mon Jan 23 12:10:41 2006</envelope-from-line><from personal="Thierry Herbelot" address="thierry@herbelot.com">Thierry Herbelot &lt;thierry@herbelot.com&gt;</from><subject normal="softdep panic at reboot (and restart)">softdep panic at reboot (and restart)</subject><date>Mon Jan 23 12:13:03 2006</date><message-id>200601232041.19159.thierry@herbelot.com</message-id><content-type>text/plain; charset=iso-8859-1</content-type><mime-version>1.0</mime-version></headers><normalized-references><normalized-message-id>200601232041.19159.thierry@herbelot.com</normalized-message-id></normalized-references><body type="text/plain; charset=iso-8859-1"><greeting depth="0">Hello,
</greeting><para depth="0">
I'm getting a new panic while rebooting after make buildworld &amp;&amp; mergemaster :

</para><para depth="0"># reboot
Waiting (max 60 seconds) for system process `vnlru' to stop...done
Waiting (max 60 seconds) for system process `bufdaemon' to stop...done
Waiting (max 60 seconds) for system process `syncer' to stop...
Syncing disks, vnodes remaining...3 2 2 2 1 0 0 0 done
All buffers synced.
panic: vm_page_free_toq: freeing mapped page 0xc11fae58
cpuid = 0
KDB: enter: panic
[thread pid 18926 tid 100089 ]
Stopped at      kdb_enter+0x2b: nop
db&gt; where
Tracing pid 18926 tid 100089 td 0xc1bf4820
kdb_enter(c0882826) at kdb_enter+0x2b
panic(c089ec94,c11fae58,c11fae58,0,c76a4994) at panic+0x127
vm_page_free_toq(c11fae58,c11fae58,40,c11fae58,c76a49ac) at 
vm_page_free_toq+0x32
vm_page_free(c11fae58) at vm_page_free+0x15
vfs_vmio_release(c3372c40) at vfs_vmio_release+0x95
brelse(c3372c40,c3372c40) at brelse+0x489
flushbuflist(c1de45cc,1,c1de45c8,0,0) at flushbuflist+0x206
bufobj_invalbuf(c1de45c8,1,c1bf4820,0,0) at bufobj_invalbuf+0x111
vinvalbuf(c1de4514,1,c1bf4820,0,0) at vinvalbuf+0x1d
vgonel(c1de4514) at vgonel+0x75
vflush(c18c1800,0,2,c1bf4820,4ae) at vflush+0x2d2
ffs_flushfiles(c18c1800,2,c1bf4820) at ffs_flushfiles+0x56
softdep_flushfiles(c18c1800,2,c1bf4820,c06ac6ee,c0934bc0) at 
softdep_flushfiles+0x1e
ffs_unmount(c18c1800,80000,c1bf4820,0,c18d8b2c) at ffs_unmount+0x32
dounmount(c18c1800,80000,c1bf4820,c33360b8,0) at dounmount+0x204
vfs_unmountall(0,8,c088284a,0,c1bf4820) at vfs_unmountall+0x46
boot(0,c094e988,0,c088284a,a1) at boot+0x3c6
reboot(c1bf4820,c76a4d04,c1bf4820,0,2) at reboot+0x32
syscall(3b,3b,3b,0,2) at syscall+0x27e
Xint0x80_syscall() at Xint0x80_syscall+0x1f
--- syscall (55, FreeBSD ELF32, reboot), eip = 0x280add0f, esp = 0xbfbfedcc, 
ebp = 0xbfbfee18 ---
db&gt;          
db&gt; ps
  pid   proc     uid  ppid  pgrp  flag   stat  wmesg    wchan  cmd
18926 c1bf3ac8    0     1 18926 0004002 [CPU 0] reboot
   41 c18a4ac8    0     0     0 0000204 [SLPQ m:w1 0xc18a8100][SLP] g_mirror 
files1
   40 c18a4cf0    0     0     0 0000204 [SLPQ - 0xc72ccd04][SLP] schedcpu
   39 c18a6000    0     0     0 0000204 [SLPQ - 0xc09a2dec][SLP] nfsiod 3
   38 c17a8cf0    0     0     0 0000204 [SLPQ - 0xc09a2de8][SLP] nfsiod 2
   37 c182b000    0     0     0 0000204 [SLPQ - 0xc09a2de4][SLP] nfsiod 1
   36 c182b228    0     0     0 0000204 [SLPQ - 0xc09a2de0][SLP] nfsiod 0
   35 c182b450    0     0     0 0000204 [SLPQ ktsusp 0xc182b4d4][SLP] vnlru
   34 c182b678    0     0     0 0000204 [SLPQ ktsusp 0xc182b6fc][SLP] syncer
   33 c182b8a0    0     0     0 0000204 [SLPQ ktsusp 0xc182b924][SLP] 
bufdaemon
   32 c182bac8    0     0     0 000020c [CPU 1] pagezero
   31 c182bcf0    0     0     0 0000204 [SLPQ psleep 0xc09a8c3c][SLP] vmdaemon
    9 c182e000    0     0     0 0000204 [SLPQ psleep 0xc09a8bfc][SLP] 
pagedaemon
    8 c182e228    0     0     0 0000204 [SLPQ m:w1 0xc1830300][SLP] g_mirror 
gm0s1
   30 c182e450    0     0     0 0000204 [IWAIT] irq5: pcm1
    7 c16f5678    0     0     0 0000204 [SLPQ - 0xc16cbe3c][SLP] fdc0
   29 c16f58a0    0     0     0 0000204 [IWAIT] swi0: sio
   28 c16f5ac8    0     0     0 0000204 [IWAIT] irq7: ppc0
   27 c16f5cf0    0     0     0 0000204 [IWAIT] irq1: atkbd0
   26 c17a8000    0     0     0 0000204 [IWAIT] irq17: atapci1
   25 c17a8228    0     0     0 0000204 [IWAIT] irq18: pcm0++
   24 c17a8450    0     0     0 0000204 [SLPQ usbtsk 0xc094c744][SLP] usbtask
   23 c17a8678    0     0     0 0000204 [SLPQ usbevt 0xc17b1210][SLP] usb0
   22 c17a88a0    0     0     0 0000204 [IWAIT] irq19: dc0 uhci0
   21 c17a8ac8    0     0     0 0000204 [IWAIT] irq15: ata1
   20 c16e2228    0     0     0 0000204 [IWAIT] irq14: ata0
    6 c16e2450    0     0     0 0000204 [SLPQ - 0xc1792300][SLP] thread taskq
   19 c16e2678    0     0     0 0000204 [IWAIT] swi6: Giant taskq
   18 c16e28a0    0     0     0 0000204 [IWAIT] swi6: task queue
    5 c16e2ac8    0     0     0 0000204 [SLPQ - 0xc1792580][SLP] kqueue taskq
   17 c16e2cf0    0     0     0 0000204 [IWAIT] swi2: cambio
   16 c16f5000    0     0     0 0000204 [IWAIT] swi5: +
   15 c16f5228    0     0     0 0000204 [SLPQ - 0xc094a3a0][SLP] yarrow
    4 c16f5450    0     0     0 0000204 [SLPQ - 0xc094cebc][SLP] g_down
    3 c16dd000    0     0     0 0000204 [SLPQ - 0xc094ceb8][SLP] g_up
    2 c16dd228    0     0     0 0000204 [SLPQ - 0xc094ceb0][SLP] g_event
   14 c16dd450    0     0     0 0000204 [IWAIT] swi1: net
   13 c16dd678    0     0     0 0000204 [IWAIT] swi3: vm
   12 c16dd8a0    0     0     0 000020c [RUNQ] swi4: clock sio
   11 c16ddac8    0     0     0 000020c [Can run] idle: cpu0
   10 c16ddcf0    0     0     0 000020c [Can run] idle: cpu1
    1 c16e2000    0     0     1 0004200 [SLPQ wait 0xc16e2000][SLP] init
    0 c094cfc0    0     0     0 0000200 [IWAIT] swapper
db&gt; 
db&gt; show thread
  100089 (0xc1bf4820)  kdb_enter(c0882826) at kdb_enter+0x2b
  100047 (0xc18a5680)  sched_switch(c18a5680,0,1) at sched_switch+0x183
  100048 (0xc18a54e0)  sched_switch(c18a54e0,0,1) at sched_switch+0x183
  100049 (0xc18a5340)  sched_switch(c18a5340,0,1) at sched_switch+0x183
  100027 (0xc16e3d00)  sched_switch(c16e3d00,0,1) at sched_switch+0x183
  100028 (0xc16e3b60)  sched_switch(c16e3b60,0,1) at sched_switch+0x183
  100029 (0xc16e39c0)  sched_switch(c16e39c0,0,1) at sched_switch+0x183
  100030 (0xc16e3820)  sched_switch(c16e3820,0,1) at sched_switch+0x183
  100031 (0xc16e3680)  sched_switch(c16e3680,0,1) at sched_switch+0x183
  100032 (0xc16e34e0)  sched_switch(c16e34e0,0,1) at sched_switch+0x183
  100033 (0xc182d000)  cpustop_handler(c72a6c74,c0814bb1,317,c182d000,0) at 
cpustop_handler+0x31
  100034 (0xc182cd00)  sched_switch(c182cd00,0,1) at sched_switch+0x183
  100035 (0xc182cb60)  sched_switch(c182cb60,0,1) at sched_switch+0x183
  100036 (0xc182c9c0)  sched_switch(c182c9c0,0,1) at sched_switch+0x183
  100037 (0xc182c820)  fork_trampoline() at fork_trampoline
  100017 (0xc16df680)  sched_switch(c16df680,0,1) at sched_switch+0x183
  100018 (0xc16df4e0)  sched_switch(c16df4e0,0,1) at sched_switch+0x183
  100019 (0xc16df340)  fork_trampoline() at fork_trampoline
  100020 (0xc16df1a0)  fork_trampoline() at fork_trampoline
  100021 (0xc17a9820)  fork_trampoline() at fork_trampoline
  100022 (0xc17a9680)  sched_switch(c17a9680,0,1) at sched_switch+0x183
  100023 (0xc17a94e0)  sched_switch(c17a94e0,0,1) at sched_switch+0x183
  100024 (0xc17a9340)  sched_switch(c17a9340,0,1) at sched_switch+0x183
  100025 (0xc17a91a0)  fork_trampoline() at fork_trampoline
  100026 (0xc17a9000)  sched_switch(c17a9000,0,1) at sched_switch+0x183
  100008 (0xc16de1a0)  sched_switch(c16de1a0,0,1) at sched_switch+0x183
  100009 (0xc16de000)  sched_switch(c16de000,0,1) at sched_switch+0x183
  100010 (0xc16e3340)  fork_trampoline() at fork_trampoline
  100011 (0xc16e31a0)  sched_switch(c16e31a0,0,1) at sched_switch+0x183
  100012 (0xc16e3000)  sched_switch(c16e3000,0,1) at sched_switch+0x183
  100013 (0xc16dfd00)  fork_trampoline() at fork_trampoline
  100014 (0xc16dfb60)  fork_trampoline() at fork_trampoline
  100015 (0xc16df9c0)  sched_switch(c16df9c0,0,1) at sched_switch+0x183
  100016 (0xc16df820)  sched_switch(c16df820,0,1) at sched_switch+0x183
  100000 (0xc16df000)  sched_switch(c16df000,0,1) at sched_switch+0x183
  100001 (0xc16ded00)  sched_switch(c16ded00,0,1) at sched_switch+0x183
  100002 (0xc16deb60)  fork_trampoline() at fork_trampoline
  100003 (0xc16de9c0)  fork_trampoline() at fork_trampoline
  100004 (0xc16de820)  sched_switch(c16de820,0,1) at sched_switch+0x183
  100005 (0xc16de680)  sched_switch(c16de680,c17a9000,6) at sched_switch+0x183
  100006 (0xc16de4e0)  sched_switch(c16de4e0,0,1) at sched_switch+0x183
  100007 (0xc16de340)  sched_switch(c16de340,0,1) at sched_switch+0x183
       0 (0xc094d200)  sched_switch(c094d200,0,1) at sched_switch+0x183

</para><para depth="0">I get a similar panic at startup :

</para><para depth="0">GDB: no debug ports present
KDB: debugger backends: ddb
KDB: current backend: ddb
Copyright (c) 1992-2006 The FreeBSD Project.
Copyright (c) 1979, 1980, 1983, 1986, 1988, 1989, 1991, 1992, 1993, 1994
        The Regents of the University of California. All rights reserved.
FreeBSD 7.0-CURRENT #1059: Mon Jan 23 12:22:22 CET 2006
    XXX@YYYfiles1/obj/files1/src/sys/GENERIC
WARNING: WITNESS option enabled, expect reduced performance.
Timecounter "i8254" frequency 1193182 Hz quality 0
CPU: Pentium II/Pentium II Xeon/Celeron (334.09-MHz 686-class CPU)
  Origin = "GenuineIntel"  Id = 0x665  Stepping = 5

</para><para depth="0">Features=0x183fbff&lt;FPU,VME,DE,PSE,TSC,MSR,PAE,MCE,CX8,APIC,SEP,MTRR,PGE,MCA,CMOV,PAT,PSE36,MMX,FXSR&gt;
.....
Starting file system checks:
/dev/mirror/gm0s1a: 2349 files, 47905 used, 51158 free (2478 frags, 6085 
blocks, 2.5% fragmentation)
panic: vm_page_free_toq: freeing mapped page 0xc11b6a88
cpuid = 0
KDB: enter: panic
[thread pid 80 tid 100039 ]
Stopped at      kdb_enter+0x2b: nop
db&gt; where
Tracing pid 80 tid 100039 td 0xc182c4e0
kdb_enter(c0882826) at kdb_enter+0x2b
panic(c089ec94,c11b6a88,c11b6a88,0,c7294780) at panic+0x127
vm_page_free_toq(c11b6a88,c11b6a88,40,c11b6a88,c7294798) at 
vm_page_free_toq+0x32
vm_page_free(c11b6a88) at vm_page_free+0x15
vfs_vmio_release(c3337b98) at vfs_vmio_release+0x95
brelse(c3337b98,c3337b98) at brelse+0x489
flushbuflist(c18f94c8,0,c18f94c4,0,0) at flushbuflist+0x206
bufobj_invalbuf(c18f94c4,0,c182c4e0,0,0) at bufobj_invalbuf+0x111
vinvalbuf(c18f9410,0,c182c4e0,0,0) at vinvalbuf+0x1d
ffs_reload(c188cc00,c182c4e0,c18b1c80,c18e5200,c1904104) at ffs_reload+0x481
ffs_mount(c188cc00,c182c4e0,20000000,5001,c106c788) at ffs_mount+0x570
vfs_domount(c182c4e0,c18b5380,c18b5440,51001,c18b52c0) at vfs_domount+0x50b
vfs_donmount(c182c4e0,51001,c7294ba8,c1902b80,c) at vfs_donmount+0x374
kernel_mount(c18b5270,51001,0,0,0) at kernel_mount+0x6d
ffs_cmount(c18b5270,bfbfed80,51001,c182c4e0,c09251e0) at ffs_cmount+0x5d
mount(c182c4e0,c7294d04,c0813aca,82,c0666d37) at mount+0x156
syscall(3b,3b,3b,0,a000050) at syscall+0x27e
Xint0x80_syscall() at Xint0x80_syscall+0x1f
--- syscall (21, FreeBSD ELF32, mount), eip = 0x280cd047, esp = 0xbfbfec9c, 
ebp = 0xbfbfee08 ---
db&gt;
</para></body></message>