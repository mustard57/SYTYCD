<message message-id="AANLkTilxhSiG9w-O4CrdqB-xYa2qpFPcvk22_1_f9Qx_@mail.gmail.com" list="org.netbeans.openide.dev" id="24ayobzs3fggtto3" no-archive="yes" type="development" date="2010-07-02T20:45:34+10:00" year="2010-01-01" year-month="2010-07-01" year-month-day="2010-07-02" thread-id="b37nsddm6bso7nf6"><headers><envelope-from-line>Fri Jul 02 02:47:16 2010</envelope-from-line><from personal="Damian Carey" address="jamianb@gmail.com">Damian Carey &lt;jamianb@gmail.com&gt;</from><to personal="dev@platform.netbeans.org" address="dev@platform.netbeans.org">dev@platform.netbeans.org</to><subject normal="[platform-dev] Re: RCP and JAXB">[platform-dev] Re: RCP and JAXB</subject><received>from srv-117d-be06.markmail.marklogic.com ([172.19.8.66])
          by mail-1.a.markmail.int (JAMES SMTP Server 2.3.1) with SMTP ID 479;
          Fri, 2 Jul 2010 02:47:16 -0800 (GMT-08:00)</received><received>from mailout02.kenai.com (slb-117n.markmail.marklogic.com [172.19.8.33])
	by mgw-2.public.markmail.int (Postfix) with ESMTP id 99D993B300C3;
	Fri,  2 Jul 2010 03:46:53 -0700 (PDT)</received><received>from mail01.netbeans.org (nbxmlm01z1.network.org [192.9.171.188])
	by mailout02.kenai.com (Postfix) with ESMTP id 79DF79562;
	Fri,  2 Jul 2010 10:47:16 +0000 (GMT)</received><received>from localhost (localhost [127.0.0.1])
	by mail01.netbeans.org (Postfix) with ESMTP id 489E120DF0;
	Fri,  2 Jul 2010 10:47:16 +0000 (GMT)</received><x-virus-scanned>amavisd-new at network.org</x-virus-scanned><received>from mail01.netbeans.org ([127.0.0.1])
	by localhost (nbxmlm01z1.network.org [127.0.0.1]) (amavisd-new, port 10025)
	with ESMTP id uahD64yz0TAh; Fri,  2 Jul 2010 10:47:16 +0000 (GMT)</received><received>by mail01.netbeans.org (Postfix, from userid 60005)
	id 0382820DEA; Fri,  2 Jul 2010 10:47:15 +0000 (GMT)</received><received>from mailin02.kenai.com (mailin02.network.org [192.9.171.174])
	by mail01.netbeans.org (Postfix) with ESMTP id F144520962
	for &lt;dev@platform.netbeans.org&gt;; Fri,  2 Jul 2010 10:45:39 +0000 (GMT)</received><received>from localhost (localhost [127.0.0.1])
	by mailin02.kenai.com (Postfix) with ESMTP id D57B025752
	for &lt;dev@platform.netbeans.org&gt;; Fri,  2 Jul 2010 10:45:39 +0000 (GMT)</received><x-virus-scanned>amavisd-new at network.org</x-virus-scanned><received>from mailin02.kenai.com ([127.0.0.1])
	by localhost (mailin02.network.org [127.0.0.1]) (amavisd-new, port 10025)
	with ESMTP id dRP-t-JAx2tc for &lt;dev@platform.netbeans.org&gt;;
	Fri,  2 Jul 2010 10:45:35 +0000 (GMT)</received><received>from mail-px0-f170.google.com (mail-px0-f170.google.com [209.85.212.170])
	by mailin02.kenai.com (Postfix) with ESMTP id 7835225746
	for &lt;dev@platform.netbeans.org&gt;; Fri,  2 Jul 2010 10:45:35 +0000 (GMT)</received><received>by pxi1 with SMTP id 1so1271790pxi.15
        for &lt;dev@platform.netbeans.org&gt;; Fri, 02 Jul 2010 03:45:34 -0700 (PDT)</received><dkim-signature>v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type
         :content-transfer-encoding;
        bh=mLnqLYa7UUvYWoyaVcCjLZr3PQ2JtfQ7pse4W9hy9ME=;
        b=A7IzmzKtD34FP0nBPGPAXXEllc+u9WpMhsAASJeO0V1jFIDQ6Eoi4vLJi+9RN1os5k
         85dpp5xyxgeBMPqspuyeJAM/gwkPcwDg3hIoZ1gL94IzJPueGmVPC8ViXT+CRGNpPk6r
         9IhTcHvUOqbUte8BowUnV2ME0DxoenDnLOTpQ=</dkim-signature><domainkey-signature>a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type:content-transfer-encoding;
        b=qbyzfrc5XqpvVf0hsA1ZKhmAxoFWDyL2zLO0Q/29KpwN9V66r3/Fg/uHixJ2hMve+d
         +VcDRX4Pne4igaG73iXsq6+6bQuS2KyYIo0fy+hWpn+sHQPIZaDBdgb0gU7zUW6St+h5
         EdHkKQcoN0ESobXwsarpsJ27enT7bXH3Tdy2I=</domainkey-signature><mime-version>1.0</mime-version><received>by 10.142.223.21 with SMTP id v21mr750943wfg.315.1278067534750; Fri, 
	02 Jul 2010 03:45:34 -0700 (PDT)</received><received>by 10.142.69.4 with HTTP; Fri, 2 Jul 2010 03:45:34 -0700 (PDT)</received><in-reply-to>&lt;4C2A69CF.2050302@geomatys.fr&gt;</in-reply-to><references>&lt;4C2A69CF.2050302@geomatys.fr&gt;</references><date>Fri, 2 Jul 2010 20:45:34 +1000</date><message-id>AANLkTilxhSiG9w-O4CrdqB-xYa2qpFPcvk22_1_f9Qx_@mail.gmail.com</message-id><content-type>text/plain; charset=ISO-8859-1</content-type><content-transfer-encoding>quoted-printable</content-transfer-encoding><reply-to>dev@platform.netbeans.org</reply-to><x-loop>dev@platform.netbeans.org</x-loop><x-sequence>4856</x-sequence><errors-to>dev-owner@platform.netbeans.org</errors-to><precedence>list</precedence><x-no-archive>yes</x-no-archive><list-id>&lt;dev.platform.netbeans.org&gt;</list-id><list-help>&lt;mailto:sympa@platform.netbeans.org?subject=help&gt;</list-help><list-subscribe>&lt;mailto:sympa@platform.netbeans.org?subject=subscribe%20dev&gt;</list-subscribe><list-unsubscribe>&lt;mailto:sympa@platform.netbeans.org?subject=unsubscribe%20dev&gt;</list-unsubscribe><list-post>&lt;mailto:dev@platform.netbeans.org&gt;</list-post><list-owner>&lt;mailto:dev-request@platform.netbeans.org&gt;</list-owner></headers><normalized-references><normalized-message-id>AANLkTilxhSiG9w-O4CrdqB-xYa2qpFPcvk22_1_f9Qx_@mail.gmail.com</normalized-message-id><normalized-in-reply-to>4C2A69CF.2050302@geomatys.fr</normalized-in-reply-to><normalized-reference>4C2A69CF.2050302@geomatys.fr</normalized-reference></normalized-references><body type="text/plain; charset=iso-8859-1"><para depth="0">Johann,

</para><para depth="0">Classloaders are 99% genius and 1% torture. Each netbeans module has a
separate classloader to keep it separate from the others.  The trick I
use to solve the problem you see is to briefly swap in the System
ClassLoader that DOES have access to everything, instead of the module
classloaders that do not have visibility of the whole system.

</para><para depth="0">Here is a snip of the sort of thing we do ...

</para><para depth="0">        ClassLoader existing = Thread.currentThread().getContextClassLoader();
        ClassLoader systemClassLoader =
Lookup.getDefault().lookup(ClassLoader.class);
        Thread.currentThread().setContextClassLoader(systemClassLoader);

</para><para depth="0">        // now - lets convert the JAXB object to an XML String ...
        String xml = null;
        try {
            xml = jaxbObj2Xml(jaxbObject, location);
        } catch (JAXBException jaxbex) {
            // log your error - although hopefully you will get no more ...
        } finally {
            // reinstate the pre-existing ClassLoader ...
            Thread.currentThread().setContextClassLoader(existing);
        }

</para><para depth="0">Greater minds than mine may suggest that it is a bad idea - but since
we've been using this we have had zero issues.

</para><para depth="0">Hope this helps you too.

</para><para depth="0">Cheers,
-Damian

</para><para depth="0">On Wed, Jun 30, 2010 at 7:46 AM, johann sorel &lt;<email>johann.sorel@geomatys.fr</email>&gt; wrote:
</para><quote depth="1"><quotepara depth="1">Hello,

</quotepara><quotepara depth="1">I am looking for a correct way to solve jaxb loading problems in the rcp.

</quotepara><quotepara depth="1">Actually when one of my packages try to use jaxb, I end up with this error :

</quotepara><quotepara depth="1">javax.xml.bind.JAXBException
 - with linked exception:
[java.lang.ClassNotFoundException: Will not load class
com.sun.xml.bind.v2.ContextFactory arbitrarily from one of
ModuleCL@703aef16[org.puzzlegis.pz.geotoolkit.pending] and
ModuleCL@694b081b[javax.xml.bind] starting from SystemClassLoader[72
modules]; see <url>http://wiki.netbeans.org/DevFaqModuleCCE</url>]
   at javax.xml.bind.ContextFinder.newInstance(ContextFinder.java:187)
   at javax.xml.bind.ContextFinder.find(ContextFinder.java:363)
   at javax.xml.bind.JAXBContext.newInstance(JAXBContext.java:574)
   at javax.xml.bind.JAXBContext.newInstance(JAXBContext.java:522)
   at org.geotoolkit.xml.MarshallerPool.&lt;init&gt;(MarshallerPool.java:151)
   at org.geotoolkit.xml.MarshallerPool.&lt;init&gt;(MarshallerPool.java:137)
   at org.geotoolkit.sld.xml.XMLUtilities.&lt;clinit&gt;(XMLUtilities.java:100)
   at
org.puzzlegis.core.project.filetype.Encoder.parseLayer(Encoder.java:142)
   at
org.puzzlegis.core.project.filetype.Encoder.parseContext(Encoder.java:89)
   at
org.puzzlegis.core.project.filetype.GISContextDataObject.getContext(GISContextDataObject.java:173)
   at
org.puzzlegis.core.windows.mapdetail.ContextTreeTopComponent$1$1.run(ContextTreeTopComponent.java:80)
Caused by: java.lang.ClassNotFoundException: Will not load class
com.sun.xml.bind.v2.ContextFactory arbitrarily from one of
ModuleCL@703aef16[org.puzzlegis.pz.geotoolkit.pending] and
ModuleCL@694b081b[javax.xml.bind] starting from SystemClassLoader[72
modules]; see <url>http://wiki.netbeans.org/DevFaqModuleCCE</url>
   at org.netbeans.ProxyClassLoader.loadClass(ProxyClassLoader.java:244)
   at java.lang.ClassLoader.loadClass(ClassLoader.java:248)
   at javax.xml.bind.ContextFinder.safeLoadClass(ContextFinder.java:481)
   at javax.xml.bind.ContextFinder.newInstance(ContextFinder.java:185)
   ... 10 more
Caused: java.lang.RuntimeException: Could not load jaxbcontext for sld 100.
   at org.geotoolkit.sld.xml.XMLUtilities.&lt;clinit&gt;(XMLUtilities.java:102)
Caused: java.lang.ExceptionInInitializerError
   at
org.puzzlegis.core.project.filetype.Encoder.parseLayer(Encoder.java:142)
   at
org.puzzlegis.core.project.filetype.Encoder.parseContext(Encoder.java:89)
   at
org.puzzlegis.core.project.filetype.GISContextDataObject.getContext(GISContextDataObject.java:173)
[catch] at
org.puzzlegis.core.windows.mapdetail.ContextTreeTopComponent$1$1.run(ContextTreeTopComponent.java:80)

</quotepara><quotepara depth="1">JaxB has always been troublesome api as far as I remember, different
integrated version in servers (glassfish/tomcat/...) which
often conflict, no spec version handle and so on... , and all no-backward
compatibility it has. I don't know what politic has the netbeans team about
it but the more projects I do using it the more I consider jaxb deprecated.

</quotepara><quotepara depth="1">I spended plenty of time already solving problems related to different jaxb
version and I don't want to continue on this path if I'm going to have some
more in the netbeans platform, so is there a safe way to load jaxb in
netbeans rcp ? (on maven build)
Or should I consider rewritting my reader/writers in a more commun xml api ?

</quotepara><quotepara depth="1">thanks

</quotepara><quotefooter type="signature" depth="1" hash="14789763031803810153">johann

</quotefooter></quote></body></message>