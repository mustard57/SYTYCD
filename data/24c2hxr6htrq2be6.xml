<message message-id="2a6743b21d0a8bec71d543ae8f53176d@issues.asterisk.org" list="com.digium.lists.asterisk-bugs" id="24c2hxr6htrq2be6" type="bugs" date="2009-05-22T06:55:46.953427-08:00" year="2009-01-01" year-month="2009-05-01" year-month-day="2009-05-22" thread-id="rlp52ej2432i2erg"><headers><envelope-from-line>Fri May 22 06:56:09 2009</envelope-from-line><from personal="Asterisk Bug Tracker" address="noreply@bugs.digium.com">Asterisk Bug Tracker &lt;noreply@bugs.digium.com&gt;</from><to personal="asterisk-bugs@lists.digium.com" address="asterisk-bugs@lists.digium.com">asterisk-bugs@lists.digium.com</to><subject normal="[asterisk-bugs] [Asterisk 0013823]: Response to REGISTER is sent to wrong address when using rport">[asterisk-bugs] [Asterisk 0013823]: Response to REGISTER is sent to wrong address when using rport</subject><received>from srv-117d-be06.markmail.marklogic.com ([172.19.8.66])
          by mail-1.a.markmail.int (JAMES SMTP Server 2.3.1) with SMTP ID 317
          for &lt;lynne.carpenter.patrick@a.markmail.org&gt;;
          Fri, 22 May 2009 06:56:09 -0800 (GMT-08:00)</received><received>from lists.digium.com (slb-117n.markmail.marklogic.com [172.19.8.33])
	by mgw-2.public.markmail.int (Postfix) with ESMTP id 7D4733B300B8
	for &lt;lynne.carpenter.patrick@a.markmail.org&gt;; Fri, 22 May 2009 07:55:46 -0700 (PDT)</received><received>from localhost ([127.0.0.1] helo=INXS.digium.internal)
	by lists.digium.com with esmtp (Exim 4.63)
	(envelope-from &lt;asterisk-bugs-bounces@lists.digium.com&gt;)
	id 1M7WAJ-0005Dn-QO; Fri, 22 May 2009 09:56:08 -0500</received><received>from [10.17.1.7] (helo=mail.digium.com)
	by lists.digium.com with esmtp (Exim 4.63)
	(envelope-from &lt;noreply-bugs@digium.com&gt;) id 1M7WAF-0005D2-Jg
	for asterisk-bugs@lists.digium.com; Fri, 22 May 2009 09:56:04 -0500</received><received>from static-76-164-171-226.apid.com ([76.164.171.226]
	helo=hotblack.digium.internal)
	by mail.digium.com with esmtp (Exim 4.63)
	(envelope-from &lt;noreply-bugs@digium.com&gt;) id 1M7W6Z-0000pP-9D
	for asterisk-bugs@lists.digium.com; Fri, 22 May 2009 09:52:15 -0500</received><received>from www-data by hotblack.digium.internal with local (Exim 4.69)
	(envelope-from &lt;noreply-bugs@digium.com&gt;) id 1M7WAF-0006ky-FF
	for asterisk-bugs@lists.digium.com; Fri, 22 May 2009 09:56:03 -0500</received><date>Fri, 22 May 2009 09:56:03 -0500</date><message-id>2a6743b21d0a8bec71d543ae8f53176d@issues.asterisk.org</message-id><x-priority>3</x-priority><x-mailer>PHPMailer [version 1.73]</x-mailer><keywords>[Asterisk] Channels/chan_sip/General</keywords><in-reply-to>&lt;b8a131fe725fbe2556b36b823d5bf666&gt;</in-reply-to><mime-version>1.0</mime-version><x-beenthere>asterisk-bugs@lists.digium.com</x-beenthere><x-mailman-version>2.1.9</x-mailman-version><precedence>list</precedence><list-id>&lt;asterisk-bugs.lists.digium.com&gt;</list-id><list-unsubscribe>&lt;http://lists.digium.com/mailman/listinfo/asterisk-bugs&gt;,
	&lt;mailto:asterisk-bugs-request@lists.digium.com?subject=unsubscribe&gt;</list-unsubscribe><list-archive>&lt;http://lists.digium.com/pipermail/asterisk-bugs&gt;</list-archive><list-post>&lt;mailto:asterisk-bugs@lists.digium.com&gt;</list-post><list-help>&lt;mailto:asterisk-bugs-request@lists.digium.com?subject=help&gt;</list-help><list-subscribe>&lt;http://lists.digium.com/mailman/listinfo/asterisk-bugs&gt;,
	&lt;mailto:asterisk-bugs-request@lists.digium.com?subject=subscribe&gt;</list-subscribe><content-type>text/plain; charset="us-ascii"</content-type><content-transfer-encoding>7bit</content-transfer-encoding><sender>asterisk-bugs-bounces@lists.digium.com</sender><errors-to>asterisk-bugs-bounces@lists.digium.com</errors-to></headers><normalized-references><normalized-message-id>2a6743b21d0a8bec71d543ae8f53176d@issues.asterisk.org</normalized-message-id><normalized-in-reply-to>b8a131fe725fbe2556b36b823d5bf666</normalized-in-reply-to></normalized-references><body type="text/plain; charset=&quot;us-ascii&quot;"><para depth="0">
The following issue has been ASSIGNED. 
====================================================================== 
<url>https://issues.asterisk.org/view.php?id=13823</url> 
====================================================================== 
Reported By:                dimas
Assigned To:                dvossel
====================================================================== 
Project:                    Asterisk
Issue ID:                   13823
Category:                   Channels/chan_sip/General
Reproducibility:            always
Severity:                   minor
Priority:                   normal
Status:                     assigned
Target Version:             1.4.26
Asterisk Version:           1.4.21.2 
Regression:                 No 
SVN Branch (only for SVN checkouts, not tarball releases): N/A 
SVN Revision (number only!):  
Request Review:              
====================================================================== 
Date Submitted:             2008-11-02 12:08 CST
Last Modified:              2009-05-22 09:56 CDT
====================================================================== 
Summary:                    Response to REGISTER is sent to wrong address when
using rport
Description: 
I have client behind NAT. 
when client (10.0.0.17) sends REGISTER request, it puts rport into Via
header. check_via notices that and sets SIP_NAT_ROUTE to the &amp;p-&gt;flags[0] -
note the log line:

</para><para depth="0">Sending to 192.168.7.211 : 5079 (NAT)

</para><para depth="0">however the register_verify function later does 
  ast_copy_flags(&amp;p-&gt;flags[0], &amp;peer-&gt;flags[0], SIP_NAT); 
effectively overwritting the value with SIP_NAT_RFC3581. And finally,
check_auth send response back to client to the wrong address which is
visible from the log line 

</para><para depth="0">&lt;--- Transmitting (no NAT) to 10.0.0.17:5079 ---&gt;

</para><para depth="0">====================================================================== 

</para><para depth="0">Issue History 
Date Modified    Username       Field                    Change               
====================================================================== 
2009-05-22 09:56 dvossel        Status                   new =&gt; assigned     
2009-05-22 09:56 dvossel        Assigned To               =&gt; dvossel         
======================================================================

</para><para depth="0">_______________________________________________
--Bandwidth and Colocation Provided by <url>http://www.api-digital.com--</url>

</para><para depth="0">asterisk-bugs mailing list
To UNSUBSCRIBE or update options visit:
   <url>http://lists.digium.com/mailman/listinfo/asterisk-bugs</url>
</para></body></message>