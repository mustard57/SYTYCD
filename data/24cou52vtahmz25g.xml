<message message-id="1289379870-14493-1-git-send-email-marek.belisko@gmail.com" list="org.kernel.vger.linux-kernel" id="24cou52vtahmz25g" type="development" date="2010-11-10T01:02:25.393968-08:00" year="2010-01-01" year-month="2010-11-01" year-month-day="2010-11-10" thread-id="24cou52vtahmz25g"><headers><envelope-from-line>Wed Nov 10 01:02:48 2010</envelope-from-line><from personal="Marek Belisko" address="marek.belisko@gmail.com">Marek Belisko &lt;marek.belisko@gmail.com&gt;</from><to personal="Greg Kroah-Hartman" address="gregkh@suse.de">Greg Kroah-Hartman &lt;gregkh@suse.de&gt;</to><cc personal="devel@driverdev.osuosl.org" address="devel@driverdev.osuosl.org">devel@driverdev.osuosl.org</cc><subject normal="[PATCH] staging: ft100: Create common return point.">[PATCH] staging: ft100: Create common return point.</subject><received>from srv-117c-be06.markmail.marklogic.com ([172.19.8.46])
          by mail-1.a.markmail.int (JAMES SMTP Server 2.3.1) with SMTP ID 221
          for &lt;archive.user.1834@a.markmail.org&gt;;
          Wed, 10 Nov 2010 01:02:48 -0800 (GMT-08:00)</received><received>from vger.kernel.org (slb-117n.markmail.marklogic.com [172.19.8.33])
	by mgw-1.public.markmail.int (Postfix) with ESMTP id D477929081E6
	for &lt;archive.user.1834@a.markmail.org&gt;; Wed, 10 Nov 2010 01:02:24 -0800 (PST)</received><received>(majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1755242Ab0KJJCW (ORCPT
	&lt;rfc822;archive.user.1834@a.markmail.org&gt;);
	Wed, 10 Nov 2010 04:02:22 -0500</received><received>from mail-bw0-f46.google.com ([209.85.214.46]:60604 "EHLO
	mail-bw0-f46.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1754952Ab0KJJCR (ORCPT
	&lt;rfc822;linux-kernel@vger.kernel.org&gt;);
	Wed, 10 Nov 2010 04:02:17 -0500</received><received>by bwz15 with SMTP id 15so478016bwz.19
        for &lt;linux-kernel@vger.kernel.org&gt;; Wed, 10 Nov 2010 01:02:15 -0800 (PST)</received><dkim-signature>v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:received:received:from:to:cc:subject:date
         :message-id:x-mailer;
        bh=nI3S9gFPlH8eYzA0DtMWie/X93/WmpwhccqtvYiOpmg=;
        b=ZlVKV5lZ8Bx7SQLM81oPg54sJnQs822qmukCu2dmw88UrtvgWvLrAwVs7PmjrCXdTL
         jlehWI9IwAqn+UQRl6M5fIsptu77vqXZnMuFIXG9UGYnl0yj0OYec7Hrc/xByhEiLv2b
         0iOTvK/6a8Z6Ku2FLOArylnRV6uvld0ns2BbA=</dkim-signature><domainkey-signature>a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=from:to:cc:subject:date:message-id:x-mailer;
        b=f56DHb+MO7w1MGzYpYpyv3elYK7fLyyQmC7qPA8bB87QIBbwCRNsFMDQ/u4m3wcSmm
         J6xF9FQPV/ZzTP0Gjb516ZfsmBIB2P6NyWgSARl9g492lpm02Rx3bQH6byXlmqdRzYcn
         KrW3+g+89XwJtiB8lHW2Uis8TwtTgqM6uFA7Y=</domainkey-signature><received>by 10.204.97.131 with SMTP id l3mr7674592bkn.112.1289379735217;
        Wed, 10 Nov 2010 01:02:15 -0800 (PST)</received><received>from localhost.localdomain (a2.trenkwalder-roznavska.ba.cust.gts.sk [195.168.25.50])
        by mx.google.com with ESMTPS id p22sm158007bkp.9.2010.11.10.01.02.13
        (version=TLSv1/SSLv3 cipher=RC4-MD5);
        Wed, 10 Nov 2010 01:02:14 -0800 (PST)</received><date>Wed, 10 Nov 2010 10:04:30 +0100</date><message-id>1289379870-14493-1-git-send-email-marek.belisko@gmail.com</message-id><x-mailer>git-send-email 1.7.1</x-mailer><sender>linux-kernel-owner@vger.kernel.org</sender><precedence>bulk</precedence><list-id>&lt;linux-kernel.vger.kernel.org&gt;</list-id><x-mailing-list>linux-kernel@vger.kernel.org</x-mailing-list></headers><normalized-references><normalized-message-id>1289379870-14493-1-git-send-email-marek.belisko@gmail.com</normalized-message-id></normalized-references><body type="text/plain"><para depth="0">When reg_ft1000_netdev() fails created kthread isn't stopped.
So add return point for stopping thread.

</para><para depth="0">Signed-off-by: Marek Belisko &lt;<email>marek.belisko@gmail.com</email>&gt;
</para><para depth="0">---
 drivers/staging/ft1000/ft1000-usb/ft1000_usb.c |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

</para><para depth="0">diff --git a/drivers/staging/ft1000/ft1000-usb/ft1000_usb.c<br/>b/drivers/staging/ft1000/ft1000-usb/ft1000_usb.c
index dcbc97c..99e3339 100644
--- a/drivers/staging/ft1000/ft1000-usb/ft1000_usb.c
+++ b/drivers/staging/ft1000/ft1000-usb/ft1000_usb.c
@@ -178,15 +178,13 @@ static int ft1000_probe(struct usb_interface *interface,

</para><para depth="0"> 	if (IS_ERR(pft1000info-&gt;pPollThread)) {
 		ret = PTR_ERR(pft1000info-&gt;pPollThread);
-		goto err_load;
+		goto err_thread;
 	}

</para><para depth="0"> 	msleep(500);

</para><para depth="0"> 	while (!pft1000info-&gt;CardReady) {
 		if (gPollingfailed) {
-			if (pft1000info-&gt;pPollThread)
-				kthread_stop(pft1000info-&gt;pPollThread);
 			ret = -EIO;
 			goto err_load;
 		}
@@ -207,6 +205,8 @@ static int ft1000_probe(struct usb_interface *interface,
 	return 0;

</para><para depth="0"> err_load:
+	kthread_stop(pft1000info-&gt;pPollThread);
+err_thread:
 	kfree(pFileStart);
 err_fw:
 	kfree(ft1000dev);
</para><footer type="signature" depth="0" hash="17453987520883910942">-- 
1.7.1

</footer><footer type="list-management" depth="0">--
To unsubscribe from this list: send the line "unsubscribe linux-kernel" in
the body of a message to <email>majordomo@vger.kernel.org</email>
More majordomo info at  <url>http://vger.kernel.org/majordomo-info.html</url>
Please read the FAQ at  <url>http://www.tux.org/lkml/</url>
</footer></body></message>