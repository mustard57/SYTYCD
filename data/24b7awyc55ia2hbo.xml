<message message-id="4BEC3256.5060403@redhat.com" list="com.redhat.fedora-directory-users" id="24b7awyc55ia2hbo" type="users" date="2010-05-13T11:09:42-06:00" year="2010-01-01" year-month="2010-05-01" year-month-day="2010-05-13" thread-id="naugt7qjkb7g34dh"><headers><envelope-from-line>Thu May 13 09:10:11 2010</envelope-from-line><from personal="Rich Megginson" address="rmeggins@redhat.com">Rich Megginson &lt;rmeggins@redhat.com&gt;</from><to personal="General discussion list for the 389 Directory server project." address="389-users@lists.fedoraproject.org">"General discussion list for the 389 Directory server project." &lt;389-users@lists.fedoraproject.org&gt;</to><subject normal="[389-users] Skipped request ...">Re: [389-users] Skipped request ...</subject><received>from srv-117d-be06.markmail.marklogic.com ([172.19.8.66])
          by mail-1.a.markmail.int (JAMES SMTP Server 2.3.1) with SMTP ID 1003
          for &lt;perry.carson.moss@a.markmail.org&gt;;
          Thu, 13 May 2010 09:10:11 -0800 (GMT-08:00)</received><received>from bastion.fedoraproject.org (slb-117n.markmail.marklogic.com [172.19.8.33])
	by mgw-2.public.markmail.int (Postfix) with ESMTP id 05A073B300B9
	for &lt;perry.carson.moss@a.markmail.org&gt;; Thu, 13 May 2010 10:09:48 -0700 (PDT)</received><received>from lists.fedoraproject.org (collab1.vpn.fedoraproject.org [192.168.1.21])
	by bastion02.phx2.fedoraproject.org (Postfix) with ESMTP id 833AC110FFC;
	Thu, 13 May 2010 17:10:10 +0000 (UTC)</received><received>from collab1.fedoraproject.org (localhost.localdomain [127.0.0.1])
	by lists.fedoraproject.org (Postfix) with ESMTP id 140CA3267A1;
	Thu, 13 May 2010 17:10:10 +0000 (UTC)</received><x-original-to>389-users@lists.fedoraproject.org</x-original-to><delivered-to>389-users@lists.fedoraproject.org</delivered-to><received>from smtp-mm1.fedoraproject.org (smtp-mm1.fedoraproject.org
	[80.239.156.217])
	by lists.fedoraproject.org (Postfix) with ESMTP id 2915932678E
	for &lt;389-users@lists.fedoraproject.org&gt;;
	Thu, 13 May 2010 17:10:08 +0000 (UTC)</received><received>from mx1.redhat.com (mx1.redhat.com [209.132.183.28])
	by smtp-mm1.fedoraproject.org (Postfix) with ESMTP id C02EA87E5C
	for &lt;389-users@lists.fedoraproject.org&gt;;
	Thu, 13 May 2010 17:10:06 +0000 (UTC)</received><received>from int-mx04.intmail.prod.int.phx2.redhat.com
	(int-mx04.intmail.prod.int.phx2.redhat.com [10.5.11.17])
	by mx1.redhat.com (8.13.8/8.13.8) with ESMTP id o4DHA5d2011360
	(version=TLSv1/SSLv3 cipher=DHE-RSA-AES256-SHA bits=256 verify=OK)
	for &lt;389-users@lists.fedoraproject.org&gt;; Thu, 13 May 2010 13:10:05 -0400</received><received>from localhost.localdomain (vpn-241-42.phx2.redhat.com [10.3.241.42])
	by int-mx04.intmail.prod.int.phx2.redhat.com (8.13.8/8.13.8) with ESMTP
	id o4DHA4ga020357
	for &lt;389-users@lists.fedoraproject.org&gt;; Thu, 13 May 2010 13:10:05 -0400</received><message-id>4BEC3256.5060403@redhat.com</message-id><date>Thu, 13 May 2010 11:09:42 -0600</date><organization>Sec Eng (Directory Server)</organization><user-agent>Thunderbird 2.0.0.24 (X11/20100311)</user-agent><mime-version>1.0</mime-version><references>&lt;DF7F294AF4153D498141CBEFADB177049A5B46EDBB@EMBX01-WF.jnpr.net&gt;</references><in-reply-to>&lt;DF7F294AF4153D498141CBEFADB177049A5B46EDBB@EMBX01-WF.jnpr.net&gt;</in-reply-to><x-scanned-by>MIMEDefang 2.67 on 10.5.11.17</x-scanned-by><x-beenthere>389-users@lists.fedoraproject.org</x-beenthere><x-mailman-version>2.1.9</x-mailman-version><precedence>list</precedence><reply-to>"General discussion list for the 389 Directory server project."
	&lt;389-users@lists.fedoraproject.org&gt;</reply-to><list-id>"General discussion list for the 389 Directory server project."
	&lt;389-users.lists.fedoraproject.org&gt;</list-id><list-unsubscribe>&lt;https://admin.fedoraproject.org/mailman/listinfo/389-users&gt;, 
	&lt;mailto:389-users-request@lists.fedoraproject.org?subject=unsubscribe&gt;</list-unsubscribe><list-archive>&lt;http://lists.fedoraproject.org/pipermail/389-users&gt;</list-archive><list-post>&lt;mailto:389-users@lists.fedoraproject.org&gt;</list-post><list-help>&lt;mailto:389-users-request@lists.fedoraproject.org?subject=help&gt;</list-help><list-subscribe>&lt;https://admin.fedoraproject.org/mailman/listinfo/389-users&gt;, 
	&lt;mailto:389-users-request@lists.fedoraproject.org?subject=subscribe&gt;</list-subscribe><content-type>text/plain; charset="us-ascii"</content-type><content-transfer-encoding>7bit</content-transfer-encoding><sender>389-users-bounces@lists.fedoraproject.org</sender><errors-to>389-users-bounces@lists.fedoraproject.org</errors-to></headers><normalized-references><normalized-message-id>4BEC3256.5060403@redhat.com</normalized-message-id><normalized-in-reply-to>DF7F294AF4153D498141CBEFADB177049A5B46EDBB@EMBX01-WF.jnpr.net</normalized-in-reply-to><normalized-reference>DF7F294AF4153D498141CBEFADB177049A5B46EDBB@EMBX01-WF.jnpr.net</normalized-reference></normalized-references><body type="text/plain; charset=&quot;us-ascii&quot;"><para depth="0">Reinhard Nappert wrote:
</para><quote depth="1"><quotepara depth="1">Rich, which debugging level do you suggest? Apparently, I tried to much, because<br/>it would crash the server constantly.
</quotepara></quote><para depth="0">Debugging levels should not crash the server - can provide more 
information about the crash?
</para><quote depth="1"><quotepara depth="1">For now, I go just with 8 (Connection Management). Seeing the problem, what<br/>would you enable?

</quotepara></quote><para depth="0">Yes, start with 8.
</para><quote depth="1"><quotepara depth="1">Thanks,
-Reinhard 

</quotepara><quote depth="2"><quotepara depth="2">-----Original Message-----
From: <email>389-users-bounces@lists.fedoraproject.org</email><br/>[mailto:<email>389-users-bounces@lists.fedoraproject.org</email>] On Behalf Of Rich Megginson
Sent: Wednesday, May 12, 2010 6:50 PM
To: General discussion list for the 389 Directory server project.
Subject: Re: [389-users] Skipped request ...

</quotepara><quotepara depth="2">Reinhard Nappert wrote:

</quotepara><quote depth="3"><quotepara depth="3">Hi Rich,

</quotepara><quotepara depth="3">I ran some further tests. This entire thing looks kind of weird. I have a kind<br/>of monitoring tool, I use to figure out if the server still responds in a timely<br/>manner. This tool performs an anonymous bind and reads a specific object, every<br/>30 seconds.

</quotepara></quote><quotepara depth="2">Does it perform an unbind operation?  Does it disconnect the socket?

</quotepara><quote depth="3"><quotepara depth="3"> What I see is that the server responds to the incoming request and it performs<br/>about 500 requests within those 30 seconds. Then, I see, when the next<br/>monitoring connection request comes is, but I never see the bind. Since this<br/>times out, the monitoring tool restarts the server after a while (about 10<br/>seconds).

</quotepara><quotepara depth="3">Here are the logs in access:
[11/May/2010:22:12:20 -0400] conn=94 fd=83 slot=83 connection from 
127.0.0.1 to 127.0.0.1
[11/May/2010:22:13:24 -0400] conn=0 fd=64 slot=64 SSL connection from 
10.227.6.45 to 10.227.6.53

</quotepara><quotepara depth="3">So, you see the server does not respond to any requests after 
[11/May/2010:22:12:20 -0400] conn=94 fd=83 slot=83 connection from 
127.0.0.1 to 127.0.0.1

</quotepara><quotepara depth="3">And start responding, once it was restarted:
[11/May/2010:22:13:24 -0400] conn=0 fd=64 slot=64 SSL connection from 
10.227.6.45 to 10.227.6.53

</quotepara><quotepara depth="3">I was wondering , if we could get somehow some debugging out of ns-slapd, once<br/>it is in this state (truss or something else).

</quotepara></quote><quotepara depth="2"><url>http://directory.fedoraproject.org/wiki/FAQ#Troubleshooting</url>
If that produces too much error log output, or kills the performance, you can<br/>also try replacing the error log with a named pipe+script -<br/><url>http://directory.fedoraproject.org/wiki/Named_Pipe_Log_Script</url>
man ds-logpipe.py

</quotepara><quote depth="3"><quotepara depth="3">Any help is appreciated.

</quotepara><quotepara depth="3">Thanks,
-Reinhard

</quotepara><quote depth="4"><quotepara depth="4">-----Original Message-----
From: <email>389-users-bounces@lists.fedoraproject.org</email><br/>[mailto:<email>389-users-bounces@lists.fedoraproject.org</email>] On Behalf Of Rich Megginson
Sent: Tuesday, May 11, 2010 5:21 PM
To: General discussion list for the 389 Directory server project.
Subject: Re: [389-users] Skipped request ...

</quotepara><quotepara depth="4">Reinhard Nappert wrote:

</quotepara><quote depth="5"><quotepara depth="5">Hi all,

</quotepara><quotepara depth="5">I have seen a weird behavior of my DS (1.1.2). It has a very small 
database (only about 2300 objects). A client performed a one-level 
search retrieving the children. The server find 114 objects, but the 
search was very slow:

</quotepara><quotepara depth="5">[06/May/2010:12:23:11 +0000] conn=127 op=149 SRCH base=&lt;base&gt; scope=1 
filter="(&amp;(&amp;(objectClass=&lt;xyz&gt;)(&lt;att1&gt;=value))(!(&lt;att2&gt;=TRUE)))"

</quotepara><quotepara depth="5">yes, the filter is a bit complex, but both attribute types &lt;att1&gt; and 
&lt;att2&gt; are indexed. This search usually is fast. It looks to me that 
the server is already in a funny state.
...
[06/May/2010:12:23:17 +0000] conn=127 op=149 RESULT err=3 tag=101
nentries=114 etime=7

</quotepara></quote><quotepara depth="4">err=3 is TIMELIMIT_EXCEEDED - that's probably why you aren't getting all of the<br/>results you expect, and could be why it's skipping the op.

</quotepara><quote depth="5"><quotepara depth="5">When the client gets the results, it iterates over those and gets its 
children, like:

</quotepara><quotepara depth="5">[06/May/2010:12:23:17 +0000] conn=127 op=150 SRCH base=&lt;dn of result 
from previous SRCH&gt; scope=1 
filter="(&amp;(&amp;(objectClass=&lt;uvw&gt;)(&lt;attr3&gt;=*))(!(&lt;attr2&gt;=TRUE)))" attrs=ALL.
Those searches are quick:
[06/May/2010:12:23:17 +0000] conn=127 op=150 RESULT err=0 tag=101
nentries=1 etime=0

</quotepara><quotepara depth="5">but somehow the server does not process on of the requests, when the 
client iterates over the results:

</quotepara><quotepara depth="5">[06/May/2010:12:23:18 +0000] conn=127 op=263 SRCH base=&lt;dn of result 
from previous SRCH&gt; scope=1 
filter="(&amp;(&amp;(objectClass=&lt;uvw&gt;)(&lt;attr3&gt;=*))(!(&lt;attr2&gt;=TRUE)))" attrs=ALL.
[06/May/2010:12:23:18 +0000] conn=127 op=263 RESULT err=0 tag=101
nentries=1 etime=0
[06/May/2010:12:23:26 +0000] conn=127 op=265 SRCH base=&lt;dn of result 
from previous SRCH&gt; scope=1 
filter="(&amp;(&amp;(objectClass=&lt;uvw&gt;)(&lt;attr3&gt;=*))(!(&lt;attr2&gt;=TRUE)))" attrs=ALL.
[06/May/2010:12:23:26 +0000] conn=127 op=265 RESULT err=0 tag=101 
nentries=0 etime=0 You can see that the server skipped op=264. It 
looks to me that the request came in, but somehow the server joked up, 
before it could log the request in access.

</quotepara><quotepara depth="5">Has anybody seen such a behavior before?

</quotepara><quotepara depth="5">Thanks,
-Reinhard

</quotepara><quotefooter type="noise" depth="5">----------------------------------------------------------------------
</quotefooter><quotefooter type="noise" depth="5">--

</quotefooter><quotefooter type="list-management" depth="5">--
389 users mailing list
<email>389-users@lists.fedoraproject.org</email>
<url>https://admin.fedoraproject.org/mailman/listinfo/389-users</url>

</quotefooter></quote><quotefooter type="list-management" depth="4">--
389 users mailing list
<email>389-users@lists.fedoraproject.org</email>
<url>https://admin.fedoraproject.org/mailman/listinfo/389-users</url>
</quotefooter><quotefooter type="list-management" depth="4">--
389 users mailing list
<email>389-users@lists.fedoraproject.org</email>
<url>https://admin.fedoraproject.org/mailman/listinfo/389-users</url>

</quotefooter></quote><quotefooter type="list-management" depth="3">--
389 users mailing list
<email>389-users@lists.fedoraproject.org</email>
<url>https://admin.fedoraproject.org/mailman/listinfo/389-users</url>
</quotefooter><quotefooter type="list-management" depth="3">--
389 users mailing list
<email>389-users@lists.fedoraproject.org</email>
<url>https://admin.fedoraproject.org/mailman/listinfo/389-users</url>

</quotefooter></quote><quotefooter type="list-management" depth="2">--
389 users mailing list
<email>389-users@lists.fedoraproject.org</email>
<url>https://admin.fedoraproject.org/mailman/listinfo/389-users</url>
</quotefooter></quote></quote></body></message>