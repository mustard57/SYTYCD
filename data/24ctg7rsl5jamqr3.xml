<message message-id="200612070441.kB74fTLs030373@shell0.pdx.osdl.net" list="org.kernel.vger.linux-ext4" id="24ctg7rsl5jamqr3" type="development" date="2006-12-06T20:41:28-08:00" year="2006-01-01" year-month="2006-12-01" year-month-day="2006-12-06" thread-id="24ctg7rsl5jamqr3"><headers><envelope-from-line>From nntpsnarfer@fakefrom.com  Mon Jan  1 12:00:00 1990</envelope-from-line><from personal="akpm@osdl.org" address="akpm@osdl.org">akpm@osdl.org</from><cc personal="akpm@osdl.org" address="akpm@osdl.org">akpm@osdl.org</cc><subject normal="[patch 348/354] ext3 balloc: use io_error label">[patch 348/354] ext3 balloc: use io_error label</subject><path>news.gmane.org!not-for-mail</path><newsgroups>gmane.comp.file-systems.ext4</newsgroups><date>Wed, 06 Dec 2006 20:41:28 -0800</date><lines>31</lines><approved>news@gmane.org</approved><message-id>200612070441.kB74fTLs030373@shell0.pdx.osdl.net</message-id><nntp-posting-host>dough.gmane.org</nntp-posting-host><x-trace>sea.gmane.org 1165466505 23373 80.91.229.10 (7 Dec 2006 04:41:45 GMT)</x-trace><x-complaints-to>usenet@sea.gmane.org</x-complaints-to><nntp-posting-date>Thu, 7 Dec 2006 04:41:45 +0000 (UTC)</nntp-posting-date><original-x-from>linux-ext4-owner@vger.kernel.org Thu Dec 07 05:41:43 2006</original-x-from><return-path>linux-ext4-owner@vger.kernel.org</return-path><envelope-to>gcfe-linux-ext4@gmane.org</envelope-to><original-received>from vger.kernel.org ([209.132.176.167])
	by dough.gmane.org with esmtp (Exim 4.50)
	id 1GsB4m-0007UL-5N
	for gcfe-linux-ext4@gmane.org; Thu, 07 Dec 2006 05:41:40 +0100</original-received><original-received>(majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S968767AbWLGElj (ORCPT &lt;rfc822;gcfe-linux-ext4@m.gmane.org&gt;);
	Wed, 6 Dec 2006 23:41:39 -0500</original-received><original-received>(majordomo@vger.kernel.org) by vger.kernel.org id S968769AbWLGElj
	(ORCPT &lt;rfc822;linux-ext4-outgoing&gt;); Wed, 6 Dec 2006 23:41:39 -0500</original-received><original-received>from smtp.osdl.org ([65.172.181.25]:47559 "EHLO smtp.osdl.org"
	rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
	id S968767AbWLGEli (ORCPT &lt;rfc822;linux-ext4@vger.kernel.org&gt;);
	Wed, 6 Dec 2006 23:41:38 -0500</original-received><original-received>from shell0.pdx.osdl.net (fw.osdl.org [65.172.181.6])
	by smtp.osdl.org (8.12.8/8.12.8) with ESMTP id kB74fUID025104
	(version=TLSv1/SSLv3 cipher=EDH-RSA-DES-CBC3-SHA bits=168 verify=NO);
	Wed, 6 Dec 2006 20:41:30 -0800</original-received><original-received>from localhost.localdomain (shell0.pdx.osdl.net [10.9.0.31])
	by shell0.pdx.osdl.net (8.13.1/8.11.6) with ESMTP id kB74fTLs030373;
	Wed, 6 Dec 2006 20:41:29 -0800</original-received><original-to>torvalds@osdl.org</original-to><x-spam-status>No, hits=-0.494 required=5 tests=AWL,NO_REAL_NAME,OSDL_HEADER_SUBJECT_BRACKETED</x-spam-status><x-spam-checker-version>SpamAssassin 2.63-osdl_revision__1.106__</x-spam-checker-version><x-mimedefang-filter>osdl$Revision: 1.162 $</x-mimedefang-filter><x-scanned-by>MIMEDefang 2.36</x-scanned-by><original-sender>linux-ext4-owner@vger.kernel.org</original-sender><precedence>bulk</precedence><x-mailing-list>linux-ext4@vger.kernel.org</x-mailing-list><xref>news.gmane.org gmane.comp.file-systems.ext4:671</xref><archived-at>&lt;http://permalink.gmane.org/gmane.comp.file-systems.ext4/671&gt;</archived-at></headers><normalized-references><normalized-message-id>200612070441.kB74fTLs030373@shell0.pdx.osdl.net</normalized-message-id></normalized-references><body type="text/plain"><para depth="0">From: Hugh Dickins &lt;<email>hugh@veritas.com</email>&gt;

</para><para depth="0">ext3_new_blocks has a nice io_error label for setting -EIO, so goto that in
the one place that doesn't already use it.

</para><para depth="0">Signed-off-by: Mingming Cao &lt;<email>cmm@us.ibm.com</email>&gt;
Signed-off-by: Hugh Dickins &lt;<email>hugh@veritas.com</email>&gt;
Cc: &lt;<email>linux-ext4@vger.kernel.org</email>&gt;
Signed-off-by: Andrew Morton &lt;<email>akpm@osdl.org</email>&gt;
</para><para depth="0">---

</para><para depth="0"> fs/ext3/balloc.c |    6 ++----
 1 file changed, 2 insertions(+), 4 deletions(-)

</para><para depth="0">diff -puN fs/ext3/balloc.c~ext3-balloc-use-io_error-label fs/ext3/balloc.c
--- a/fs/ext3/balloc.c~ext3-balloc-use-io_error-label
+++ a/fs/ext3/balloc.c
@@ -1515,10 +1515,8 @@ retry_alloc:
 		if (group_no &gt;= ngroups)
 			group_no = 0;
 		gdp = ext3_get_group_desc(sb, group_no, &amp;gdp_bh);
-		if (!gdp) {
-			*errp = -EIO;
-			goto out;
-		}
+		if (!gdp)
+			goto io_error;
 		free_blocks = le16_to_cpu(gdp-&gt;bg_free_blocks_count);
 		/*
 		 * skip this group if the number of
_

</para></body></message>