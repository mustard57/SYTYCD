<message message-id="AANLkTikKW4Ncg66CHUMBQRxPQGZve7chaHO01SkuD...@mail.gmail.com" list="com.googlegroups.symfony-users" id="24byidk32vo3o7g4" type="users" date="2010-08-12T10:22:40+08:00" year="2010-01-01" year-month="2010-08-01" year-month-day="2010-08-11" thread-id="te5ajqm4bdos3y6e"><headers><envelope-from-line>Wed Aug 11 19:45:59 2010</envelope-from-line><from personal="Sebastien Armand [Pink]" address="&quot;khe...&quot;@gmail.com">"Sebastien Armand [Pink]" &lt;"khe..."@gmail.com&gt;</from><to personal="symfony-users@googlegroups.com" address="symfony-users@googlegroups.com">symfony-users@googlegroups.com</to><subject normal="[symfony-users] Re: Embedding form filters">Re: [symfony-users] Re: Embedding form filters</subject><received>from srv-117d-be06.markmail.marklogic.com ([172.19.8.66])
          by mail-1.a.markmail.int (JAMES SMTP Server 2.3.1) with SMTP ID 620
          for &lt;jill.copeland.middleton@a.markmail.org&gt;;
          Wed, 11 Aug 2010 19:45:59 -0800 (GMT-08:00)</received><received>from crawl-1.a.markmail.int (slb-117n.markmail.marklogic.com [172.19.8.33])
	by mgw-2.public.markmail.int (Postfix) with ESMTP id 598673B300CB
	for &lt;jill.copeland.middleton@a.markmail.org&gt;; Wed, 11 Aug 2010 20:45:36 -0700 (PDT)</received><received>from crawl-1.a.markmail.int (localhost.localdomain [127.0.0.1])
	by crawl-1.a.markmail.int (Postfix) with ESMTP id 3E9FA63B014E
	for &lt;jill.copeland.middleton@a.markmail.org&gt;; Wed, 11 Aug 2010 20:45:36 -0700 (PDT)</received><received>(from crawler@localhost)
	by crawl-1.a.markmail.int (8.13.8/8.13.8/Submit) id o7C3jaRi012004
	for jill.copeland.middleton@a.markmail.org; Wed, 11 Aug 2010 20:45:36 -0700</received><x-authentication-warning>crawl-1.a.markmail.int: crawler set sender to root@localhost using -r</x-authentication-warning><x-markmail-googlegroups-list>com.googlegroups.symfony-users</x-markmail-googlegroups-list><x-markmail-googlegroups-mid>b23c80931d4cddf9</x-markmail-googlegroups-mid><received>by 10.229.222.20 with SMTP id ie20mr1061384qcb.20.1281579777554;
        Wed, 11 Aug 2010 19:22:57 -0700 (PDT)</received><x-beenthere>symfony-users@googlegroups.com</x-beenthere><received>by 10.229.227.16 with SMTP id iy16ls220079qcb.2.p; Wed, 11 Aug 2010
 19:22:43 -0700 (PDT)</received><received>by 10.229.231.17 with SMTP id jo17mr938821qcb.0.1281579763888;
        Wed, 11 Aug 2010 19:22:43 -0700 (PDT)</received><received>by 10.229.231.17 with SMTP id jo17mr938820qcb.0.1281579763847;
        Wed, 11 Aug 2010 19:22:43 -0700 (PDT)</received><received>from mail-qw0-f51.google.com (mail-qw0-f51.google.com [209.85.216.51])
        by gmr-mx.google.com with ESMTP id y16si450027qce.8.2010.08.11.19.22.42;
        Wed, 11 Aug 2010 19:22:42 -0700 (PDT)</received><received-spf>pass (google.com: domain of khe...@gmail.com designates 209.85.216.51 as permitted sender) client-ip=209.85.216.51;</received-spf><authentication-results>gmr-mx.google.com; spf=pass (google.com: domain of khe...@gmail.com designates 209.85.216.51 as permitted sender) smtp.mail=khe...@gmail.com; dkim=pass (test mode) header...@gmail.com</authentication-results><received>by qwj9 with SMTP id 9so1005444qwj.24
        for &lt;symfony-users@googlegroups.com&gt;; Wed, 11 Aug 2010 19:22:42 -0700 (PDT)</received><dkim-signature>v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:received:in-reply-to
         :references:date:message-id:subject:from:to:content-type;
        bh=5qoElOUecCHxe2wJtZhIBFRXvGqtshKv8XPllLRubsI=;
        b=sARsE1wGJ7Q2kWj++D9wfz4dxM49iKhhWnoceqx1FtriLGQaSlWPXUkeDthZVVCX3d
         2qPwdnfrdGZE9W7UkbK+jTUwz36RujWIMLadVWjTEaQ6KG3U8X6Emvqdx7BdqUEjbdF2
         xBjcdzJ0o3BVrhLY++TKccANl8jubscD6ATOk=</dkim-signature><domainkey-signature>a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=hvdoLMt/DFVgTfIOSLu7ugFIDH0G9R+7RFkB1jaTENOUKpuHBG5q1ZcNGWYOV0IA/b
         EN3rs8b3/vXsDF8sHCW+IT/FZS1GEJ5iW7C5IS05c8HdrdqVRYDxeDbv1210J+h+lTrT
         z7WeO61e98pH7FiPAurb6tPTyCkQPlkNZ21No=</domainkey-signature><mime-version>1.0</mime-version><received>by 10.229.37.3 with SMTP id v3mr10191185qcd.169.1281579760821; Wed, 
	11 Aug 2010 19:22:40 -0700 (PDT)</received><received>by 10.229.65.164 with HTTP; Wed, 11 Aug 2010 19:22:40 -0700 (PDT)</received><in-reply-to>&lt;2192faf4-a7c2-4098-9a68-64fd94e52...@t2g2000yqe.googlegroups.com&gt;</in-reply-to><references>&lt;AANLkTinnVT60vQnBREb2LTybFedwq314qNPDww9_C...@mail.gmail.com&gt;
	&lt;AANLkTinbow4y9etJ+j9BVodtptZuV=QtyTkvERcCn...@mail.gmail.com&gt;
	&lt;2192faf4-a7c2-4098-9a68-64fd94e52...@t2g2000yqe.googlegroups.com&gt;</references><date>Thu, 12 Aug 2010 10:22:40 +0800</date><message-id>AANLkTikKW4Ncg66CHUMBQRxPQGZve7chaHO01SkuD...@mail.gmail.com</message-id><content-type>multipart/alternative; boundary=001636834228652845048d970a8d</content-type></headers><normalized-references><normalized-message-id>AANLkTikKW4Ncg66CHUMBQRxPQGZve7chaHO01SkuD...@mail.gmail.com</normalized-message-id><normalized-in-reply-to>2192faf4-a7c2-4098-9a68-64fd94e52...@t2g2000yqe.googlegroups.com</normalized-in-reply-to><normalized-reference>AANLkTinnVT60vQnBREb2LTybFedwq314qNPDww9_C...@mail.gmail.com</normalized-reference><normalized-reference>AANLkTinbow4y9etJ+j9BVodtptZuV=QtyTkvERcCn...@mail.gmail.com</normalized-reference><normalized-reference>2192faf4-a7c2-4098-9a68-64fd94e52...@t2g2000yqe.googlegroups.com</normalized-reference></normalized-references><body multipart="multipart/alternative; boundary=001636834228652845048d970a8d" type="text/plain; charset=ISO-8859-1"><para depth="0">Thanks, I would definitely do that if my actual problem was as simple as my
example, the thing is that I actually have 4 tables each of them having at
least 4 fields, and that I want to browse on those fields.

</para><para depth="0">Like here, I would like to actually see the 'city' field displayed, and be
able to use it in my request without any specific school being chosen.

</para><para depth="0">2010/8/12 Tom Ptacnik &lt;<email>to...@tomor.cz</email>&gt;

</para><quote depth="1"><quotepara depth="1">I don't think that you need embed form filter.

</quotepara><quotepara depth="1">Just add a widget for selecting a school into the person formFilter
Something like:

</quotepara><quotepara depth="1">public function configure() {

</quotepara><quotepara depth="1"> $this-&gt;widgetSchema['school_id'] = new
sfWidgetFormDoctrineChoice(array(
     'model' =&gt; $this-&gt;getRelatedModelName('School'),
     'method' =&gt; 'myMethodForWhatIWhant',
     'add_empty' =&gt; true
   ));
$this-&gt;validatorSchema['school_id'].....

</quotepara><quotepara depth="1">}

</quotepara><quotepara depth="1">Then add this field to the filter, and set that it will have cutom
method for creating the query

</quotepara><quotepara depth="1">public function getFields()
 {
   $fields = parent::getFields();
   $fields['school_id'] = 'custom';
   return $fields;
 }

</quotepara><quotepara depth="1">Then create the method for altering the query for the filter

</quotepara><quotepara depth="1">This is my method for i18n join, so modify this for your WHERE query.
You can look into the sfFormFilterDoctrine class, method
addForeignKeyQuery.
Maybe you can use directly this method from the
sfFormFilterDoctrine.... you can try to not creating the custom method
- in the getFields method set type to ForeignKey (maybe foreign_key..)
 $fields['school_id'] = 'ForeignKey';

</quotepara><quotepara depth="1">public function addSchoolIdColumnQuery($query, $field, $values)
 {

</quotepara><quotepara depth="1">   $fieldName = 'title';
   $translationAlias = 't'; // Must by the same as in the
table_method
   //$query-&gt;leftJoin(sprintf('%s.%s %s', $query-&gt;getRootAlias(),
'Translation', $translationAlias)); // Translations already joined in
table_method generator settings
   //echo $query-&gt;contains('Translation t');

</quotepara><quotepara depth="1">   if (is_array($values) &amp;&amp; isset($values['is_empty']) &amp;&amp;
$values['is_empty'])
   {
     $query-&gt;addWhere(sprintf('(%s.%s IS NULL OR %1$s.%2$s = ?)',
$translationAlias, $fieldName), array(''));
   }
   else if (is_array($values) &amp;&amp; isset($values['text']) &amp;&amp; '' !=
$values['text'])
   {
     $query-&gt;addWhere(sprintf('%s.%s LIKE ?', $translationAlias,
$fieldName), '%'.$values['text'].'%');
    }
 }

</quotepara><quotepara depth="1">On 10 srp, 11:23, "Sebastien Armand [Pink]" &lt;<email>khe...@gmail.com</email>&gt; wrote:
</quotepara><quote depth="2"><quotepara depth="2">Actually I don't think what I'm looking for is a join, but a set of WHERE
conditions like:

</quotepara><quotepara depth="2">WHERE person.school_id IN (SELECT school.id FROM School WHERE city =
paris)

</quotepara><quotepara depth="2">still no clue how to get that though!

</quotepara><quotepara depth="2">2010/8/10 Sebastien Armand [Pink] &lt;<email>khe...@gmail.com</email>&gt;

</quotepara><quote depth="3"><quotepara depth="3">Hello everyone!
</quotepara></quote><quotepara depth="2">
</quotepara><quote depth="3"><quotepara depth="3">New day new issue!
</quotepara></quote><quotepara depth="2">
</quotepara><quote depth="3"><quotepara depth="3">let's imagine the following model:
</quotepara></quote><quotepara depth="2">
</quotepara><quote depth="3"><quotepara depth="3">person:
  name:
  nickname:
  school_id:
</quotepara></quote><quotepara depth="2">
</quotepara><quote depth="3"><quotepara depth="3">school:
  name:
  city:
</quotepara></quote><quotepara depth="2">
</quotepara><quote depth="3"><quotepara depth="3">I want to have a filter on 'person' to browse through the person
database.
And in that filter I want to be able to choose the city they studied
</quotepara></quote></quote><quotepara depth="1">in.
</quotepara><quote depth="2"><quotefooter type="noise" depth="2">
</quotefooter><quote depth="3"><quotepara depth="3">What I did so far is:
use the standard PersonFormFilter, this works like a charm, no problem
embed a SchoolFormFilter in the PersonFormFilter
</quotepara></quote><quotefooter type="noise" depth="2">
</quotefooter><quote depth="3"><quotepara depth="3">when doing so, the first problem appears: while binding the
PersonFormFilter to its values, the embedded form will not be bound to
anything.
If trying to bind it separately, I get a csrf error because no csrf
token
is included in the values for the school. Adding it manually only
brings up
a csrf attack detection.
</quotepara></quote><quotefooter type="noise" depth="2">
</quotefooter><quote depth="3"><quotepara depth="3">So disabled the CSRF protection on the embedded form.
</quotepara></quote><quotefooter type="noise" depth="2">
</quotefooter><quote depth="3"><quotepara depth="3">Now I can get my 2 filters and get a look at the queries generated.
What
would be wonderful from now is to be able to build a join of those 2
queries.
</quotepara></quote><quotefooter type="noise" depth="2">
</quotefooter><quote depth="3"><quotepara depth="3">However, the 2 queries being built independently, they are using the
same
alias: 'r' which causes a conflict.
</quotepara></quote><quotefooter type="noise" depth="2">
</quotefooter><quote depth="3"><quotepara depth="3">Also it seems a pretty complicated way to work, anyone knows of a
better /
much more simple and clean solution, or at least can help me going
</quotepara></quote></quote><quotepara depth="1">forward?

</quotepara><quotefooter type="signature" depth="1" hash="17016056312425912187">--
If you want to report a vulnerability issue on symfony, please send it to
security at symfony-project.com

</quotefooter><quotepara depth="1">You received this message because you are subscribed to the Google
Groups "symfony users" group.
To post to this group, send email to <email>symfony-users@googlegroups.com</email>
To unsubscribe from this group, send email to
symfony-users+<email>unsubscribe@googlegroups.com</email>&lt;<email>symfony-users%2Bunsubscribe@googlegroups.com</email>&gt;
For more options, visit this group at
<url>http://groups.google.com/group/symfony-users?hl=en</url>

</quotepara></quote></body></message>