<message message-id="20090113190113.342707013F@cvs1.fedora.phx.redhat.com" list="com.redhat.fedora-directory-commits" id="24bzqjdmaywiuijn" type="checkins" date="2009-01-13T11:00:57.143247-08:00" year="2009-01-01" year-month="2009-01-01" year-month-day="2009-01-13" thread-id="24bzqjdmaywiuijn"><headers><envelope-from-line>Tue Jan 13 11:01:20 2009</envelope-from-line><from personal="Richard Allen Megginson" address="rmeggins@fedoraproject.org">Richard Allen Megginson &lt;rmeggins@fedoraproject.org&gt;</from><to personal="cvsdirsec@fedoraproject.org" address="cvsdirsec@fedoraproject.org">cvsdirsec@fedoraproject.org</to><subject normal="[Fedora-directory-commits] ldapserver/ldap/servers/slapd ssl.c, 1.21, 1.22">[Fedora-directory-commits]  ldapserver/ldap/servers/slapd ssl.c, 1.21, 1.22</subject><received>from srv-117d-be06.markmail.marklogic.com ([172.19.8.66])
          by mail-1.a.markmail.int (JAMES SMTP Server 2.3.1) with SMTP ID 40
          for &lt;ethel.brooks.sampson@a.markmail.org&gt;;
          Tue, 13 Jan 2009 11:01:20 -0800 (GMT-08:00)</received><received>from hormel.redhat.com (slb-117n.markmail.marklogic.com [172.19.8.33])
	by mgw-2.public.markmail.int (Postfix) with ESMTP id BE2D43B30249
	for &lt;ethel.brooks.sampson@a.markmail.org&gt;; Tue, 13 Jan 2009 11:00:56 -0800 (PST)</received><received>from listman.util.phx.redhat.com (listman.util.phx.redhat.com [10.8.4.110])
	by hormel.redhat.com (Postfix) with ESMTP id 70286618CC1;
	Tue, 13 Jan 2009 14:01:19 -0500 (EST)</received><received>from int-mx1.corp.redhat.com (int-mx1.corp.redhat.com
	[172.16.52.254])
	by listman.util.phx.redhat.com (8.13.1/8.13.1) with ESMTP id
	n0DJ1I9G012314
	for &lt;fedora-directory-commits@listman.util.phx.redhat.com&gt;;
	Tue, 13 Jan 2009 14:01:18 -0500</received><received>from mx2.util.phx.redhat.com (mx2.util.phx.redhat.com [10.8.4.102])
	by int-mx1.corp.redhat.com (8.13.1/8.13.1) with ESMTP id
	n0DJ1Ip7019989
	for &lt;fedora-directory-commits@int-mx1.corp.redhat.com&gt;;
	Tue, 13 Jan 2009 14:01:18 -0500</received><received>from bastion.fedora.phx.redhat.com (bastion.fedora.phx.redhat.com
	[10.8.34.50])
	by mx2.util.phx.redhat.com (8.13.1/8.13.1) with ESMTP id n0DJ1HGq007945
	for &lt;fedora-directory-commits@redhat.com&gt;;
	Tue, 13 Jan 2009 14:01:17 -0500</received><received>by bastion.fedora.phx.redhat.com (Postfix, from userid 500)
	id 519E0208203; Tue, 13 Jan 2009 19:01:17 +0000 (UTC)</received><x-original-to>cvsdirsec@fedoraproject.org</x-original-to><delivered-to>cvsdirsec@fedoraproject.org</delivered-to><received>by bastion.fedora.phx.redhat.com (Postfix, from userid 404)
	id 42F03208207; Tue, 13 Jan 2009 19:01:17 +0000 (UTC)</received><x-spam-checker-version>SpamAssassin 3.2.4 (2008-01-01) on
	bastion.fedora.phx.redhat.com</x-spam-checker-version><x-spam-level/><x-spam-status>No, score=-1.6 required=5.0 tests=ALL_TRUSTED,AWL,BAYES_50
	autolearn=no version=3.2.4</x-spam-status><received>from cvs1.fedora.phx.redhat.com (cvs1.fedora.phx.redhat.com
	[10.8.34.217])
	by bastion.fedora.phx.redhat.com (Postfix) with ESMTP id 516662081FB
	for &lt;cvsdirsec@fedoraproject.org&gt;; Tue, 13 Jan 2009 19:01:13 +0000 (UTC)</received><received>by cvs1.fedora.phx.redhat.com (Postfix, from userid 100089)
	id 342707013F; Tue, 13 Jan 2009 19:01:13 +0000 (UTC)</received><content-type>TEXT/PLAIN; charset=US-ASCII</content-type><x-cvsroot>/cvs/dirsec</x-cvsroot><x-cvs-module>ldapserver</x-cvs-module><x-cvs-directory>ldapserver/ldap/servers/slapd</x-cvs-directory><x-cvs-user>rmeggins</x-cvs-user><x-cvs-server>cvs1.fedora.phx.redhat.com</x-cvs-server><precedence>first-class</precedence><message-id>20090113190113.342707013F@cvs1.fedora.phx.redhat.com</message-id><date>Tue, 13 Jan 2009 19:01:13 +0000 (UTC)</date><x-scanned-by>MIMEDefang 2.58 on 172.16.52.254</x-scanned-by><x-loop>fedora-directory-commits@redhat.com</x-loop><x-beenthere>fedora-directory-commits@redhat.com</x-beenthere><x-mailman-version>2.1.5</x-mailman-version><reply-to>fedora-directory-devel@redhat.com</reply-to><list-id>List of CVS commits to the Fedora Directory server project
	&lt;fedora-directory-commits.redhat.com&gt;</list-id><list-unsubscribe>&lt;https://www.redhat.com/mailman/listinfo/fedora-directory-commits&gt;,
	&lt;mailto:fedora-directory-commits-request@redhat.com?subject=unsubscribe&gt;</list-unsubscribe><list-archive>&lt;https://www.redhat.com/archives/fedora-directory-commits&gt;</list-archive><list-post>&lt;mailto:fedora-directory-commits@redhat.com&gt;</list-post><list-help>&lt;mailto:fedora-directory-commits-request@redhat.com?subject=help&gt;</list-help><list-subscribe>&lt;https://www.redhat.com/mailman/listinfo/fedora-directory-commits&gt;,
	&lt;mailto:fedora-directory-commits-request@redhat.com?subject=subscribe&gt;</list-subscribe><sender>fedora-directory-commits-bounces@redhat.com</sender><errors-to>fedora-directory-commits-bounces@redhat.com</errors-to></headers><normalized-references><normalized-message-id>20090113190113.342707013F@cvs1.fedora.phx.redhat.com</normalized-message-id></normalized-references><body type="text/plain; charset=us-ascii"><para depth="0">Author: rmeggins

</para><para depth="0">Update of /cvs/dirsec/ldapserver/ldap/servers/slapd
In directory<br/>cvs1.fedora.phx.redhat.com:/tmp/cvs-serv727/ldapserver/ldap/servers/slapd

</para><para depth="0">Modified Files:
	ssl.c 
Log Message:
Resolves: bug 479202
Bug Description: Acceptance test: mmrepl {accept,chainonupdate} : slapd dumps<br/>core during accept_cleanup()
Reviewed by: nkinder (Thanks!)
Fix Description: Have to call ldapssl_set_option(ld, SSL_NO_CACHE, PR_TRUE)<br/>after setting up the connection for client auth
Platforms tested: RHEL5
Flag Day: no
Doc impact: no

</para><para depth="0">Index: ssl.c
===================================================================
RCS file: /cvs/dirsec/ldapserver/ldap/servers/slapd/ssl.c,v
retrieving revision 1.21
retrieving revision 1.22
diff -u -r1.21 -r1.22
--- ssl.c	5 Dec 2008 22:41:52 -0000	1.21
+++ ssl.c	13 Jan 2009 19:01:10 -0000	1.22
@@ -1159,15 +1159,6 @@

</para><para depth="0">     /* Free config data */

</para><para depth="0">-	/* We cannot allow NSS to cache outgoing client auth connections -
-	   each client auth connection must have it's own non-shared SSL
-	   connection to the peer so that it will go through the
-	   entire handshake protocol every time including the use of its
-	   own unique client cert - see bug 605457
-	*/
-
-	ldapssl_set_option(ld, SSL_NO_CACHE, PR_TRUE);
-
 #ifndef _WIN32
     StdPinObj = (SVRCOREStdPinObj *)SVRCORE_GetRegisteredPinObj();
     err =  SVRCORE_StdPinGetPin( &amp;pw, StdPinObj, token );
@@ -1188,6 +1179,15 @@
 				SLAPI_COMPONENT_NAME_NSPR " error %d - %s)",
 			    SERVER_KEY_NAME, cert_name, rc, 
 			    errorCode, slapd_pr_strerror(errorCode));
+	} else {
+	    /* We cannot allow NSS to cache outgoing client auth connections -
+	       each client auth connection must have it's own non-shared SSL
+	       connection to the peer so that it will go through the
+	       entire handshake protocol every time including the use of its
+	       own unique client cert - see bug 605457
+	    */
+
+	    ldapssl_set_option(ld, SSL_NO_CACHE, PR_TRUE);
 	}
     }

</para><footer type="list-management" depth="0">--
Fedora-directory-commits mailing list
<email>Fedora-directory-commits@redhat.com</email>
<url>https://www.redhat.com/mailman/listinfo/fedora-directory-commits</url>
</footer></body></message>