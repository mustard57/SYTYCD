<message message-id="1260924848531@kroah.org" list="org.kernel.vger.stable-commits" id="24cq3u7l5gsftgzl" type="checkins" date="2009-12-15T16:54:09-08:00" year="2009-01-01" year-month="2009-12-01" year-month-day="2009-12-15" thread-id="24cq3u7l5gsftgzl"><headers><envelope-from-line>Tue Dec 15 16:55:43 2009</envelope-from-line><from personal="gregkh@suse.de" address="gregkh@suse.de">gregkh@suse.de</from><to personal="alexdeucher@gmail.com" address="alexdeucher@gmail.com">alexdeucher@gmail.com</to><cc personal="stable@kernel.org" address="stable@kernel.org">stable@kernel.org</cc><subject normal="patch drm-radeon-kms-handle-vblanks-properly-with-dpms-on.patch added to 2.6.32-stable tree">patch drm-radeon-kms-handle-vblanks-properly-with-dpms-on.patch added to 2.6.32-stable tree</subject><received>from srv-117c-be06.markmail.marklogic.com ([172.19.8.46])
          by mail-1.a.markmail.int (JAMES SMTP Server 2.3.1) with SMTP ID 632
          for &lt;nina.gibson.stanley@a.markmail.org&gt;;
          Tue, 15 Dec 2009 16:55:42 -0800 (GMT-08:00)</received><received>from vger.kernel.org (slb-117n.markmail.marklogic.com [172.19.8.33])
	by mgw-1.public.markmail.int (Postfix) with ESMTP id A1A812908182
	for &lt;nina.gibson.stanley@a.markmail.org&gt;; Tue, 15 Dec 2009 16:55:19 -0800 (PST)</received><received>(majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S932538AbZLPAzm (ORCPT
	&lt;rfc822;nina.gibson.stanley@a.markmail.org&gt;);
	Tue, 15 Dec 2009 19:55:42 -0500</received><received>(majordomo@vger.kernel.org) by vger.kernel.org id S932596AbZLPAzm
	(ORCPT &lt;rfc822;stable-commits-outgoing&gt;);
	Tue, 15 Dec 2009 19:55:42 -0500</received><received>from kroah.org ([198.145.64.141]:52504 "EHLO coco.kroah.org"
	rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
	id S932538AbZLPAzl (ORCPT &lt;rfc822;stable-commits@vger.kernel.org&gt;);
	Tue, 15 Dec 2009 19:55:41 -0500</received><received>from localhost (c-98-246-45-209.hsd1.or.comcast.net [98.246.45.209])
	(using TLSv1 with cipher DHE-RSA-AES128-SHA (128/128 bits))
	(No client certificate requested)
	by coco.kroah.org (Postfix) with ESMTPSA id 1C71E48A1F;
	Tue, 15 Dec 2009 16:55:41 -0800 (PST)</received><date>Tue, 15 Dec 2009 16:54:09 -0800</date><message-id>1260924848531@kroah.org</message-id><mime-version>1.0</mime-version><content-type>text/plain; charset=ANSI_X3.4-1968</content-type><sender>stable-commits-owner@vger.kernel.org</sender><precedence>bulk</precedence><reply-to>linux-kernel@vger.kernel.org</reply-to><list-id>&lt;stable-commits.vger.kernel.org&gt;</list-id><x-mailing-list>stable-commits@vger.kernel.org</x-mailing-list><content-transfer-encoding>quoted-printable</content-transfer-encoding></headers><normalized-references><normalized-message-id>1260924848531@kroah.org</normalized-message-id></normalized-references><body type="text/plain; charset=ansi_x3.4-1968"><para depth="0">
This is a note to let you know that we have just queued up the patch titled

</para><para depth="0">    Subject: drm/radeon/kms: handle vblanks properly with dpms on

</para><para depth="0">to the 2.6.32-stable tree.  Its filename is

</para><para depth="0">    drm-radeon-kms-handle-vblanks-properly-with-dpms-on.patch

</para><para depth="0">A git repo of this tree can be found at 
    <url>http://www.kernel.org/git/?p=linux/kernel/git/stable/stable-queue.git;a=summary</url>

</para><para depth="0">From 500b758725314ab1b5316eb0caa5b0fa26740e6b Mon Sep 17 00:00:00 2001
From: Alex Deucher &lt;<email>alexdeucher@gmail.com</email>&gt;
Date: Wed, 2 Dec 2009 11:46:52 -0500
Subject: drm/radeon/kms: handle vblanks properly with dpms on

</para><para depth="0">From: Alex Deucher &lt;<email>alexdeucher@gmail.com</email>&gt;

</para><para depth="0">commit 500b758725314ab1b5316eb0caa5b0fa26740e6b upstream.

</para><para depth="0">avivo chips

</para><para depth="0">Copied from pre-avivo code.

</para><para depth="0">Signed-off-by: Alex Deucher &lt;<email>alexdeucher@gmail.com</email>&gt;
Signed-off-by: Dave Airlie &lt;<email>airlied@redhat.com</email>&gt;
Signed-off-by: Greg Kroah-Hartman &lt;<email>gregkh@suse.de</email>&gt;

</para><para depth="0">---
 drivers/gpu/drm/radeon/atombios_crtc.c |    8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

</para><para depth="0">--- a/drivers/gpu/drm/radeon/atombios_crtc.c
+++ b/drivers/gpu/drm/radeon/atombios_crtc.c
@@ -241,6 +241,7 @@ void atombios_crtc_dpms(struct drm_crtc 
 {
 	struct drm_device *dev = crtc-&gt;dev;
 	struct radeon_device *rdev = dev-&gt;dev_private;
+	struct radeon_crtc *radeon_crtc = to_radeon_crtc(crtc);

</para><para depth="0"> 	switch (mode) {
 	case DRM_MODE_DPMS_ON:
@@ -248,20 +249,19 @@ void atombios_crtc_dpms(struct drm_crtc 
 		if (ASIC_IS_DCE3(rdev))
 			atombios_enable_crtc_memreq(crtc, 1);
 		atombios_blank_crtc(crtc, 0);
+		drm_vblank_post_modeset(dev, radeon_crtc-&gt;crtc_id);
+		radeon_crtc_load_lut(crtc);
 		break;
 	case DRM_MODE_DPMS_STANDBY:
 	case DRM_MODE_DPMS_SUSPEND:
 	case DRM_MODE_DPMS_OFF:
+		drm_vblank_pre_modeset(dev, radeon_crtc-&gt;crtc_id);
 		atombios_blank_crtc(crtc, 1);
 		if (ASIC_IS_DCE3(rdev))
 			atombios_enable_crtc_memreq(crtc, 0);
 		atombios_enable_crtc(crtc, 0);
 		break;
 	}
-
-	if (mode != DRM_MODE_DPMS_OFF) {
-		radeon_crtc_load_lut(crtc);
-	}
 }

</para><para depth="0"> static void

</para><para depth="0">Patches currently in stable-queue which might be from <email>alexdeucher@gmail.com</email> are

</para><para depth="0">queue-2.6.32/drm-radeon-kms-add-quirk-for-his-x1300-board.patch
queue-2.6.32/drm-radeon-kms-handle-vblanks-properly-with-dpms-on.patch
queue-2.6.32/drm-radeon-kms-fix-legacy-crtc2-dpms.patch
queue-2.6.32/drm-radeon-kms-fix-vram-setup-on-rs600.patch
queue-2.6.32/drm-radeon-kms-rs6xx-rs740-clamp-vram-to-aperture-size.patch
</para><footer type="list-management" depth="0">--
To unsubscribe from this list: send the line "unsubscribe stable-commits" in
the body of a message to <email>majordomo@vger.kernel.org</email>
More majordomo info at  <url>http://vger.kernel.org/majordomo-info.html</url>
</footer></body></message>