<message message-id="DAV36nviNI8DyVKKVd8000102c1@hotmail.com" list="org.freebsd.freebsd-ipfw" id="24c7bdwr6u3eqe5p" type="general" date="2003-04-15T12:32:02" year="2003-01-01" year-month="2003-04-01" year-month-day="2003-04-15" thread-id="24c7bdwr6u3eqe5p"><headers><envelope-from-line>From jetman516@hotmail.com  Tue Apr 15 12:32:00 2003</envelope-from-line><from personal="The Jetman" address="jetman516@hotmail.com">The Jetman &lt;jetman516@hotmail.com&gt;</from><subject normal="Why Does This Work ?">Why Does This Work ?</subject><date>Tue Apr 15 12:32:02 2003</date><message-id>DAV36nviNI8DyVKKVd8000102c1@hotmail.com</message-id><content-type>text/plain; charset=iso-8859-1</content-type><mime-version>1.0</mime-version></headers><normalized-references><normalized-message-id>DAV36nviNI8DyVKKVd8000102c1@hotmail.com</normalized-message-id></normalized-references><body type="text/plain; charset=iso-8859-1"><para depth="0">I'm using 4.8-RELEASE to implement MAC-filtering bridge for my 
wireless network.  Altho I am relatively new w/ FBSD (since Apr '02), 
I've been getting the desired results writing my own rules for IPFW.  My 
1st attempt w/ IPFW2 was successful, but I can't figure out why !

</para><para depth="0">${fwcmd} -f flush
####    permit all traffic from our wksta to anywhere via our internal iface
(1)  ${fwcmd} add permit ${ipanyany} MAC any ${wksmac} in via ${iif}
${fwcmd} add permit ${ipanyany} MAC ${wksmac} any out via ${iif}
####    permit all traffic from/to the outside iface....
${fwcmd} add permit ${ipanyany} MAC ${oifmac} any in via ${oif}
${fwcmd} add permit ${ipanyany} MAC any ${oifmac} out via ${oif}
####    block anything else coming from/going to the internal iface....
(2) ${fwcmd} add deny log ${ipanyany} MAC any any in via ${iif}
(3) ${fwcmd} add allow ${ipanyany}

</para><para depth="0">    Only rules (1), (2), and (3) fire.  Rule (1) fires for obvious 
reasons (bec it matches the pattern I've anticipated.)  Bec of how IP-based 
IPFW1 rules work, I *thought* one would have to have matching inbound/outbound 
rules.  What's most baffling is that while non-approved MAC addrs are blocked 
as desired [at rule (2)], but legal traffic is permitted back thru the bridge 
to its sender [via rule (3).]  WHY ????  I'm only showing the simplest example 
of the scripts I've been experimenting with.  I've got other scripts that 
do permit other MACs thru the bridge (either wireless of Ethernet), so I'm 
close to what I want.

</para><para depth="0">    My principal concern is that I don't rely on bogus (ie. broken) behavior 
of IPFW2, only to discover at some unspecified time in the future, this 
was never really working and my LAN was never really protected.  Or worse 
still, after I start making the script more complex, something unrelated goes 
wrong.  The only help I've been able to find is a single site, where a guy 
showed his 1st effort at an IPFW2 script, intended to do the same thing I'm 
trying to do.  Actually, I used his script, as a starting place for my 
efforts.

</para><para depth="0">    TIA....Jet

</para><footer type="signature" hash="16544865131261899938" depth="0">===============  From the desk of Jethro Wright, III  ================
+  Never attribute to malice that which is adequately explained by   +
+  incompetence.                                                     +
===  <email>jetman516@hotmail.com</email>  =====================  Hanlon's Razor  ===
</footer></body></message>